
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="PrivacyCredentials is a generic credential system which is designed to be secure, privacy-preserving, scalable, performant and robust. It is designed specifically for some important use cases where physical, on-person verification of identity of holder is needed and where normal W3C Verifiable Credential flows are not fully suitable as they are normally designed currently.">
      
      
      
        <meta name="author" content="Jesus Ruiz">
      
      
        <link rel="canonical" href="https://hesusruiz.github.io/PrivacyCredentials/print_page.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.1, mkdocs-material-7.1.8">
    
    
      
        <title>Print - PrivacyCredentials</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.f1a3b89f.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="css/print-site.css">
    
      <link rel="stylesheet" href="css/print-site-material.css">
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="normal" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="PrivacyCredentials" class="md-header__button md-logo" aria-label="PrivacyCredentials" data-md-component="logo">
      
  <img src="assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PrivacyCredentials
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Print
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/hesusruiz/PrivacyCredentials" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    hesusruiz/PrivacyCredentials
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="PrivacyCredentials" class="md-nav__button md-logo" aria-label="PrivacyCredentials" data-md-component="logo">
      
  <img src="assets/logo.png" alt="logo">

    </a>
    PrivacyCredentials
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/hesusruiz/PrivacyCredentials" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    hesusruiz/PrivacyCredentials
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Abstract
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Inroduction
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Inroduction" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Inroduction
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="features/features.html" class="md-nav__link">
        Features
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="architecture/privacy-architecture.html" class="md-nav__link">
        Architecture
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        HCERTX
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="HCERTX" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          HCERTX
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="hcertx/overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="hcertx/containerformat.html" class="md-nav__link">
        EU DCC container
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="hcertx/datamodel.html" class="md-nav__link">
        EU DCC v1 data model
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="hcertx/trustedlists.html" class="md-nav__link">
        Trusted Lists
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="hcertx/security-considerations.html" class="md-nav__link">
        Security
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" data-md-state="indeterminate" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        W3C Credentials
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="W3C Credentials" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          W3C Credentials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="credentials/w3c.html" class="md-nav__link">
        Data model
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" data-md-state="indeterminate" type="checkbox" id="__nav_5" checked>
      
      <label class="md-nav__link" for="__nav_5">
        Trust Framework
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Trust Framework" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Trust Framework
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="trustframework/tf-overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="trustframework/smart-contracts.html" class="md-nav__link">
        Smart Contracts
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" data-md-state="indeterminate" type="checkbox" id="__nav_6" checked>
      
      <label class="md-nav__link" for="__nav_6">
        DID Methods
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="DID Methods" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          DID Methods
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="didmethods/elsi.html" class="md-nav__link">
        ELSI
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" data-md-state="indeterminate" type="checkbox" id="__nav_7" checked>
      
      <label class="md-nav__link" for="__nav_7">
        Interoperability
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Interoperability" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Interoperability
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="interoperability/interoperability-eudcc.html" class="md-nav__link">
        with EUDCC
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="interoperability/interoperability-w3c.html" class="md-nav__link">
        with W3C
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
      <a href="print_page.html" class="md-nav__link md-nav__link--active">
        Print
      </a>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <div id="print-site-page" class="print-site-enumerate-figures">
        <section id="print-site-cover-page">
            
<div style="padding-bottom: 3em">

    
        <h1>PrivacyCredentials</h1>
    

    
        <h2>PrivacyCredentials is a generic credential system which is designed to be secure, privacy-preserving, scalable, performant and robust. It is designed specifically for some important use cases where physical, on-person verification of identity of holder is needed and where normal W3C Verifiable Credential flows are not fully suitable as they are normally designed currently.</h2>
    

</div>


    <p>Authors: Jesus Ruiz</p>


<p>
    
        <small>Website: <a href="https://hesusruiz.github.io/PrivacyCredentials/">https://hesusruiz.github.io/PrivacyCredentials/</a></small><br />
    
    
        <small>Repo: <a href="https://github.com/hesusruiz/PrivacyCredentials">https://github.com/hesusruiz/PrivacyCredentials</a></small><br />
    
    
</p>
        </section>
        
        <div id="print-site-banner">
            <p>
    <em>This box will disappear when printing</em>
    <span style="float: right"><a href="https://timvink.github.io/mkdocs-print-site-plugin/">mkdocs-print-site-plugin</a></span>
</p>
<p>This page combines all site pages and applies print and PDF friendly styling. Print or export to PDF using <b>File > Print > Save as PDF</b>.</p>
<p>For creating PDFs, make sure to use the browser's print and save-as-pdf function instead of the system dialog.</p>
        </div>
        
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="6">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="index"><h1 id="index-abstract">Abstract</h1>
<p><strong>PrivacyCredentials</strong> is a generic credential system which is designed to be secure, privacy-preserving, scalable, high-performance and robust. It is designed specifically for some important use cases where physical, on-person verification of identity of holder is needed and where normal W3C Verifiable Credential flows are not fully suitable as they are normally designed currently.</p>
<p>The system is designed to support credentials in different formats, initially the <a href="https://www.w3.org/TR/vc-data-model/">W3C Verifiable Credential</a> format and the <strong>HCERT</strong> format used in the <a href="https://ec.europa.eu/info/live-work-travel-eu/coronavirus-response/safe-covid-19-vaccines-europeans/eu-digital-covid-certificate_en">EU Digital COVID Certificate</a> system for health certificates in the EU.</p>
<p>It enables production implementations today, because it is designed to be compatible with all current regulations in place today in the European Union (and many other regions of the world).</p>
<p>This document describes the overall architecture of the system, including the credential formats, interaction among the actor involved and the Trust Framework which it implements.</p>
<p>Special focus is put on privacy of personal data in real-life scenarios like health-related credentials, and in interoperability with other current and future systems.</p></section><h1 class='nav-section-title'>Inroduction</h1><section class="print-page" id="features-features"><h1 id="features-features-features">Features</h1>
<p>The system supports the life cycle of a certificate:</p>
<ol>
<li>the collection and registration of data about the citizen and her associated characteristics,  </li>
<li>the issuance of a certificate, and  </li>
<li>the presentation of the certificate to a verifier for its verification.</li>
</ol>
<p>The verifier of a certificate is able to establish that: </p>
<ul>
<li>The certificate has been issued by an entity which is authorised to issue that specific type of certificate; </li>
<li>The information presented on the certificate is authentic, valid, and has not been altered; </li>
<li>The certificate can be linked to the holder of the certificate;</li>
</ul>
<p>The features of the PrivacyCredentials system are described below.</p>
<h2 id="features-features-interoperable-with-the-eu-digital-covid-certificates-from-eu-member-states">Interoperable with the EU Digital COVID Certificates from EU Member States</h2>
<ul>
<li>The PrivacyCredentials wallet can scan and store any EUDCC QR code in digital or paper format. Those credentials can coexist in the wallet with credentials in other formats (e.g., W3C VC).</li>
<li>The wallet can display the human-readable information of a stored EUDCC, including its QR code in EUDCC format so it can be verified by any compatible verifier.</li>
<li>The PrivacyCredentials verifier can scan and verify any EUDCC certificate, in paper of digital format.</li>
</ul>
<h2 id="features-features-issuance-and-verification-of-many-types-of-credentials-in-eu-dcc-format">Issuance and verification of many types of credentials in EU DCC format</h2>
<p>The PrivacyCredentials system allows entities to issue, manage and verify credentials in the same format as the standard EU DCC.</p>
<p>This means that the system reuses and leverages the knowledge and expertise involved in the development and setup of the EU Digital COVID Certificate, where privacy is of utmost importance and millions of certificates have been already issued with independently by the different Member States, while being fully interoperable.</p>
<p>Of course, this does not mean that any certificates of any type issued by PrivacyCredentials are automatically verifiable by the standard EU DCC verifiers, because this only happens for health certificates of type <strong>hcert</strong> and subtypes <strong>v</strong>, <strong>t</strong> and <strong>r</strong> (vaccination, test and recovery) and which have been signed by the entities in the Member States authorised list.</p>
<p>In other words, the PrivacyCredentials system can verify both the standard EU DCC credentials and the credentials issued with PrivacyCredentials in the EU DCC format, because PrivacyCredentials includes both Trusted Lists.</p>
<h2 id="features-features-supports-w3c-verifiable-credentials">Supports W3C Verifiable Credentials</h2>
<p>In addition to the The EU Digital COVID Certificate format, the wallet supports standard W3C Verifiable Credentials, which can coexist in the same wallet. The wallet is easily extensible to support other types of credentials found in real-life, in order to start being useful before all credentials are migrated to standard formats.</p>
<h2 id="features-features-strong-privacy-by-design-and-by-default">Strong privacy by design and by default</h2>
<p>The system is designed from scratch to protect the data of the involved natural persons, specifically certificate holders. This covers several principles expressed in the GDPR, including <strong>purpose limitation and data minimisation</strong> (<a href="https://gdpr.eu/article-5-how-to-process-personal-data/">Articles 5.1.b and 5.1.c of GDPR</a>). In particular, this implies the usage of a minimum set of data in the certificates as required for the supported use cases (data minimisation).</p>
<p>Importantly, this also implies that <strong>no personal data is registered in the blockchain</strong>. Not even a hash of the certificate is ever registered in the blockchain, because it is not required by the typical use cases supported by the system and so it may be in violation of the purpose limitation principle.</p>
<p>Abuse of data by actors (especially, the certificate verifiers and holders) and forgery should be prevented by any reasonable means. The system should by design and default ensure the security and the privacy of data in the compliant implementations, ensuring both security and privacy.</p>
<p>The system promotes the restriction of access to data and prevents malicious use of data, and at the same time it enables the establishing of the authenticity of data and its link to the certificate holder.
The design prevents the collection of identifiers or other similar data which might be cross-referenced with other data and re-used for tracking (‘Unlinkability’).</p>
<p>Unlinkability is one of the main reason why the system does not use any type of hash of personal data registered in the blockchain.</p>
<h2 id="features-features-inclusiveness-especially-medium-neutrality">Inclusiveness (especially medium-neutrality)</h2>
<p>The system should be inclusive especially towards the individual citizen (‘no citizen left behind’).</p>
<p>The design of the system should attempt to maximize its support for diverse contexts (e.g., high resource vs low resource contexts).</p>
<p>To enable this, the system supports a spectrum of certificate presentation media from plain paper certificate to augmented paper certificates (e.g., paper certificate with printed machine-readable parts such as barcodes, QR codes, Machine Readable Zones) and to purely digital certificates (e.g., in-app certificates).</p>
<p>In addition, contrary to many SSI Verifiable Credentials implementations, the PrivacyCredentials system is implemented as a PWA (Progressive Web App) that can be used simply in a mobile browser (or tablet/PC) without installing anything in the device or registering for anything.</p>
<p>However, the user can install the PWA in the device if the user so wishes to facilitate future uses. In any case, the system does not require any type of registration of the identity of the user.</p>
<h2 id="features-features-simplicity-and-user-friendliness">Simplicity and user-friendliness</h2>
<p>The PrivacyCredentials system follows the rule of <a href="https://en.wikipedia.org/wiki/Occam%27s_razor">Occam's Razor</a> eliminating any feature or functionality which is not strictly required for the target use cases. Notwithstanding this simplicity, the resulting system can be used in a surprisingly big number of real-life use cases apart from health-related ones.</p>
<p>This not only provides simplicity and user-friendliness but also provides a system easier to understand, maintain and reason about, which is more secure and robust.</p>
<h2 id="features-features-prepared-for-today-and-the-future-european-digital-identity">Prepared for today and the future European Digital Identity</h2>
<p>In PrivacyCredentials the processes of ID binding and/or verification are isolated from the certificates and rely on <strong>nationally/internationally established methods for ID binding and verification, such as national IDs and passports, and regulated customer onboarding processes</strong> (in the case of private companies).</p>
<p>In this way, PrivacyCredentials can be used today in real world use cases with full legal validity of the credentials managed in the system. At the same time, it is well prepared to use any future legal identification system like the upcoming <a href="https://ec.europa.eu/info/strategy/priorities-2019-2024/europe-fit-digital-age/european-digital-identity_en">European Digital Identity</a>.</p>
<p>ID binding refers to the mechanisms used to associate or bind the real identity of a subject and the certificate. The identity of this subject shall be bound to a certificate when the certificate is issued (ID binding) and has to be verified when the certificate is being presented and verified (ID verification). These two processes (ID binding at the Issuance step and ID verification at the Presentation and Verification step) prevent possible impersonation attempts, and are in line with the data security and privacy by design and default principles of the system.</p>
<p>The system follows the principles laid out in the eHealth Interoperability documents and generalises them to <strong>any type of credential</strong> and any type of use case where they can be applied.</p>
<p>Contrary to many SSI Verifiable Credential implementations, the PrivacyCredentials system <strong>does not require any registration on the part of the user</strong> like registering her DID in the blockchain or any other repository, as the system relies in pre-existing identification processes (e.g., KYC for private companies).</p>
<p>This clear separation of concerns allows PrivacyCredentials to work with almost any existing or future identification systems, for example with off-line ID binding systems (EU Digital COVID Certificates) or with online ID binding like what will be possible with the future European Digital Identity system.</p>
<p>The certificates should be issued according to existing national and international regulations, where the personal data elements are incorporated to the certificate and not used for any other thing or purpose. It is assumed that the minimal person identification data in the certificate can be used to perform the ID binding with a national ID, passport or any other suitable nationally issued identity document and in full compliance with the current regulations.</p>
<h2 id="features-features-allows-offline-and-online-verification">Allows offline and online verification</h2>
<p>The system is fully aligned with the future European Digital Identity, which will be available to EU citizens, residents, and businesses who want to identify themselves or provide confirmation of certain personal information. It can be used for both online and offline public and private services across the EU.</p>
<h2 id="features-features-the-wallet-does-not-need-to-be-downloaded-from-app-markets">The wallet does not need to be downloaded from app markets</h2>
<p>The wallet is implemented as a PWA (Progressive Web Application) with local storage and offline capabilities. Of course, native apps can coexist in parallel, but the incentives are low as the PWA approach is enough for typical scenarios in these use cases.</p>
<p>The wallet is Open Source standard HTML/JavaScript code, so it can be easily analysed by security experts and industry specialists for any security or privacy problem.</p>
<h2 id="features-features-the-provider-of-the-wallet-does-not-know-about-usage-of-the-wallet">The provider of the wallet does not know about usage of the wallet</h2>
<p>In order to start using the wallet, the user does not have to register in any place and never has to provide any personal data to any entity. The same wallet software can be hosted in many different places, typically in trusted servers operated by trusted entities in the ecosystem. The user can choose the provider that she wants. Even power users could host the wallet in their own servers, or citizen associations or communities could host their own version of the wallet, making sure it complies with all required properties of strong privacy and independence from commercial interests.</p>
<p>Once the wallet is loaded in the user's mobile, it never communicates back to the server that hosted the wallet, except for downloading newer versions of the software. Even this upgrade operation should be performed by initiative of the user.</p>
<h2 id="features-features-verification-does-not-require-intermediate-servers">Verification does not require intermediate servers</h2>
<p>The system supports true P2P (peer-to-peer) transmission of certificate information from the wallet to the verifier, or from paper to the verifier. This reduces potential privacy concerns, increases its independence from centralised entities, and "democratises" the verification process. Essentially, it shares many of the good properties of paper-based processes but with the efficiency and tamper-resistance of machine-readable structured documents with digital signatures.</p>
<p>This is performed via two independent and complementary mechanisms.</p>
<p>When CWT/COSE encoding can be used the resulting encoded certificate can typically be represented in a self-contained QR which can be read directly by the verifier devices (or wallets). This is in contrast with typical credentials where the QR just has a URL of a server where the real data of the credential is stored.</p>
<p>When the encoded certificate is too big to fit in a single QR, it is sent via a mechanism described elsewhere in this document. Essentially, the encoded certificate is divided into smaller packets and sent in  sequence directly to the verifier, where the packets are assembled together into the original encoded certificate. Each packet is transmitted as a QR in a looping video where each frame is a QR representing one of the pieces. The mechanism can be used in practice to send certificates with several KB in size, where the trade-off is the amount of time required to present and scan all pieces of the encoded certificate.</p>
<p>The system also supports "traditional" QRs where the QR has a URL pointing to the certificate, for situations where the above mechanisms can not be used. However this mechanism should be avoided if possible, given the problems mentioned above. Essentially, if the credential is too big for the P2P transmission mechanism, then it probably contains too much information and is in violation of the <strong>minimisation</strong> principle. In this situation it would be preferable to break the credentials into smaller ones, or use some of the selective disclosure techniques available.</p>
<p>The next version of PrivacyCredentials will include a simple but powerful selective disclosure system that does not require advanced techniques (like Zero-knowledge proof) and that is designed for most use cases where citizen data is big and is managed "on-custody", like it happens in health applications, government, banking, insurance, etc. It is also very easy to integrate in current systems, and easy to understand and reason about in terms of privacy and regulatory compliance.</p>
<h2 id="features-features-full-separation-of-natural-person-identities-from-juridical-person-identities">Full separation of natural person identities from juridical person identities</h2>
<p>In the real world the identities of juridical persons are fundamentally different to the identities of natural persons, especially with respect to privacy and consumer protection regulations.</p>
<p>As mentioned before, for natural persons PrivacyCredentials relies on legally accepted and widely deployed ID binding mechanisms, facilitating implementation and ensuring full regulatory compliance.</p>
<p>For juridical persons PrivacyCredentials uses <strong>ELSI</strong>, a DID Method which is based in widely deployed standards and that is extremely easy to integrate with existing mechanisms used globally for identification of juridical entities, again facilitating implementation and ensuring full regulatory compliance.</p>
<p>Clean separation of the mechanisms used for both types of identities  allows for easier implementation of each set of requirements, without polluting the code with logic to handle both cases, which is prone to error and promotes failures with harsh legal consequences.</p>
<p>ELSI is described in detail in <a href="#features-didmethods-elsi.md">ELSI - PrivacyCredentials</a>.</p>
<h2 id="features-features-modularity-and-scalability">Modularity and scalability</h2>
<p>The system architecture is modular and easily scalable, to additional usage scenarios, use cases and types of certificates.</p>
<p>The system is massively scalable because generation and verification of credentials are <a href="https://en.wikipedia.org/wiki/Embarrassingly_parallel">embarrassingly parallel</a> tasks and the blockchain is never a bottleneck.</p>
<p>The system already supports different usage scenarios (e.g. alternative settings in which certificates may be requested or verification may take place).</p>
<h2 id="features-features-open-standards">Open standards</h2>
<p>The system relies for its implementations on open standards, to the extent that this is possible. This contributes to the interoperability of the resulting implementation, and combined with open governance and open source implementation, it will instil trust in the involved stakeholders.</p>
<h2 id="features-features-interoperability">Interoperability</h2>
<p>Implementations of certificates that comply with the specifications should be interoperable, both at the infrastructure and at the national level.</p>
<p>This means that if Countries A and B implement the specifications, it should be possible for a verifier in Country B to verify a digital certificate that has been issued in Country A.</p>
<p>Cross-border interoperability should be ensured across EU and EEA countries. The system should be also prepared for interoperability with the solutions designed on a global level.</p></section><section class="print-page" id="architecture-privacy-architecture"><h1 id="architecture-privacy-architecture-privacy-architecture">Privacy architecture</h1>
<p>This section provides an overview of the system. The description is focused especially on the privacy characteristics of the system, given that it is the most important property. </p>
<h2 id="architecture-privacy-architecture-the-three-zones-for-personal-data">The three zones for personal data</h2>
<p>To facilitate reasoning about technology and personal data, the system can be divided into three relevant zones.</p>
<figure class="figure-image">
  <img src="architecture/Slide5.PNG" alt="The three zones for personal data">
  <figcaption>The three zones for personal data</figcaption>
</figure>

<p>At the top we have the <code>citizen's zone</code>, represented in green.
In the intermediate level we have the <code>entities zone</code>, with the businesses and organisations that manage or process personal data from the citizens, and represented in yellow.
At the bottom we have the <code>blockchain zone</code>. It is red because the fundamental rule for any blockchain application is that personal data never has to be written to the blockchain, even if it is encrypted (encrypted personal data is considered personal data if it is exposed publicly for a sufficiently long period).</p>
<p>There are many discussions about what can be considered personal data, and if a hash of personal data is considered personal data or not. But this is irrelevant here because in this system no personal data is ever written to the blockchain, including any type of hash from personal data.</p>
<p>The blockchain is used to register the public information about the identities of the juridical persons involved, including the public key that will be used to verify the signatures from the entities issuing certificates.
The blockchain stores a Trusted List of entities which are authorised to create and digitally sign certificates of a given type. The Trusted List is managed in a decentralised way and can be organised by domains, geographical regions or any other criteria that may be adequate to the use cases. It is modelled following the Internet DNS system.</p>
<h2 id="architecture-privacy-architecture-the-flow-of-a-certificate">The flow of a certificate</h2>
<p>The following figure describes the basic flow of a certificate:</p>
<figure class="figure-image">
  <img src="architecture/Slide6.PNG" alt="The flow of  certificate">
  <figcaption>The flow of  certificate</figcaption>
</figure>

<p>The authorised issuer entity creates and digitally signs the certificate, and sends it to the citizen via several mechanisms. The personal data flows are marked in red.</p>
<p>The relationship between the citizen and the issuer entity is subject to current regulation (e.g. GDPR) and the existence of the blockchain does not change anything. The diagram presents also the possibility that the entity stores some personal data in its own data base, always within the framework of the same personal data regulation.</p>
<p>The critical feature is that there is not any write operation to the blockchain during the issuance process.</p>
<p>The certificate is sent from the citizen to the verifier by means of a QR code which is implemented in such a way that there is no need for any intermediate server. Transmission is purely P2P in the safe <code>citizen's zone</code> without involvement of any entity, of course not even the issuer of the certificate.</p>
<h2 id="architecture-privacy-architecture-replicating-the-privacy-features-of-the-physical-world">Replicating the privacy features of the physical world</h2>
<p>The privacy features of the system can be better understood by making an analogy with the real world: The citizen is holding a wallet and a set of cards inside.</p>
<figure class="figure-image">
  <img src="architecture/Slide7.PNG" alt="Comparison with a physical wallet">
  <figcaption>Comparison with a physical wallet</figcaption>
</figure>

<p>This is represented in the figure above and the following properties hold:</p>
<ul>
<li>
<p>The citizen can use whatever wallet she wishes, because the wallet follows a set of standards. In the physical world, all wallets are interchangeable as far as they can hold standard-size cards.</p>
</li>
<li>
<p>The citizen can use more than one wallet, either in parallel or sequentially. In the physical world, she can easily move the cards from one wallet to another, depending on the situation (e.g. she goes to the beach and moves a subset of the cards to a special wallet for a specific period of time).</p>
</li>
<li>
<p>In order to obtain a wallet, the citizen does not need to register in any system or provide any personal data to any entity. In the analogy with the physical world, the citizen can go to a shop and pay for a wallet she likes in complete anonymity with respect to the wallet seller. There may be wallets for free (e.g. as gifts from entities), or if the customer so wishes, <code>fancy</code> wallets that the citizen has to pay.</p>
</li>
<li>
<p>The above does not preclude the existence of wallets that require registration from citizens (and so requiring personal data). In the physical world, this may be analogous to obtaining a wallet because the citizen belongs to a club or is employed in a company, or as a gift because the citizen is the customer of a company.</p>
</li>
<li>
<p>Once the citizen uses the wallet, the wallet does not send any personal information to the provider of the wallet. In the physical world, once the citizen has received the wallet, the seller of the wallet has no idea of what is the actual usage of the wallet by the citizen.</p>
</li>
<li>
<p>However the digital wallet may communicate with the wallet provider to obtain patches or upgrades, especially security fixes. In the physical world this would be analogous to the citizen going to the shop for some repairs on her wallet.</p>
</li>
</ul>
<h2 id="architecture-privacy-architecture-obtaining-the-public-keys-for-local-verification-in-the-mobile">Obtaining the public keys for local verification in the mobile</h2>
<p>We now complete the flow of information in the system for the basic credential issuance and verification process.</p>
<p>In order to be able to perform local verification of credentials in the mobile, we need the public keys of issuers. This is represented in the following figure, where the arrows are green because the information is public and in addition they are queries, never writes.</p>
<p>There may be two main scenarios: one where the verifier is an individual citizen and the second when the verifier is an employee acting on behalf of a company that wants to verify certificates as part of its business process (e.g., a hotel on check-in of guests). We discuss here the first scenario, and the second will be discussed in the next section.</p>
<figure class="figure-image">
  <img src="architecture/Slide8.PNG" alt="Public keys and local verification">
  <figcaption>Public keys and local verification</figcaption>
</figure>

<p>In this scenario there are two citizens involved: the one holding the credential and the one acting as verifier.</p>
<p>The mobile of the citizen acting as verifier can not access directly the blockchain and requires an intermediate server, operated by some entity. Typically, that entity operates both a "traditional" server and a blockchain node that it can access without restriction.</p>
<p>From the point of view of data privacy, the intermediate server can never have access to the personal data of the citizen presenting the credential to the verifier.</p>
<p>For the verifier, the amount of harm that an untrusted entity can make is very low, but in any case it is important that verifiers use a trusted server or even better a pool of trusted servers.</p>
<p>The server receives HTTP GET requests from the verifier mobile for retrieving the public keys. Even though this is not done on each verification (the verifier mobile has a cache which is updated periodically), those requests could be used to try to track the citizen acting as verifier, using techniques like for example <a href="https://en.wikipedia.org/wiki/Device_fingerprint">device fingerprinting</a>.</p>
<p>It is expected that several trusted entities like public administrations, civil organisations or highly-regulated businesses operate intermediate servers that offer publicly the single API which is required for trusted verification by citizens. The service is just a query, very simple and can use aggressive caching techniques so it can scale massively.</p>
<p>Having a pool of public trusted operators of this service improves the resiliency of the verifier against malicious attacks. The citizen acting as verifier can configure the application to build the cache of public keys from queries to several servers, detecting wrong keys and avoiding censorship of some keys or just availability problems in the servers.</p>
<h2 id="architecture-privacy-architecture-optional-verification-in-a-server">Optional: verification in a server</h2>
<p>In the case when the verifier is an employee acting on behalf of an entity and especially for very small businesses, the scheme described above can also be used. It may also be possible that an industry association provides one or more servers providing the service to its member entities, probably together with the "traditional" services that they may already be receiving from the industry association.</p>
<p>The system also supports making the verification in a given server. This feature may be useful for bigger entities and in some scenarios where they want to apply sophisticated business rules to the verification process, or when they require the storage in their databases of the credential data.</p>
<p>This is represented in the following diagram.</p>
<figure class="figure-image">
  <img src="architecture/Slide9.PNG" alt="Verification in a server">
  <figcaption>Verification in a server</figcaption>
</figure>

<p>When making the validation in the server the verifier mobile has to send the certificate to the server, and this is represented by the new arrow in the diagram. The arrow is red because there is personal data involved. The entity receiving the personal data should comply with all applicable regulations.</p>
<p>From the diagram it is easy to see that the existence of a blockchain network does not have any influence in how personal data should be handled by all actors involved.</p>
<h2 id="architecture-privacy-architecture-revocation-of-certificates">Revocation of certificates</h2>
<p>Revocation is normally a very rare event compared to the total number of credentials issued. Actually, in practice in the paper world it is very difficult to implement a real-time verification of paper credentials.</p>
<p>In the digital world, revocation is typically implemented with revocation lists, which are checked in real-time by the verifier application. With centralised technology it is very difficult to implement real-time verification of credentials without leaking information to the server where the revocation list is stored.
Typically, the revocation list is managed by the same entity that issued the credential, giving the opportunity to this entity to track usage at the individual level of the credentials that were issued, knowing where and when the credential is used.</p>
<p>Managing the revocation list in the blockchain brings several benefits. When the revocation information is inserted in one of the nodes, it is replicated in all the nodes of the network and it is available for verification in all of them. That means that the verifier can securely check in its own node without leaking any verification information to any other entity, specifically the issuer of the certificate. In addition, the verifier entity can completely manage the availability of its own node (or nodes), without reliance on the availability of any server operated by a third party.</p>
<p>However, a lot of care should be taken with the information of the certificate that is used in the revocation list, because that information will be permanent in the blockchain. If the revocation identifier is derived in some way from the personal information in the credential (e.g. hashes calculated using information in the credential), then there may be risks of reidentification in the long term, especially for credentials of a very small size and with a small number of fields.</p>
<p>In the PrivacyCredentials system each credential has a <strong>U</strong>niversally <strong>U</strong>nique <strong>ID</strong>entifier version 4 (UUID) as defined in <a href="https://datatracker.ietf.org/doc/html/rfc4122#section-4.4">RFC 4122</a>. This UUID is completely unrelated to the rest of the information in the credential and reduces the possibility of many types of attacks.</p></section><h1 class='nav-section-title-end'>Ended: Inroduction</h1><h1 class='nav-section-title'>HCERTX</h1><section class="print-page" id="hcertx-overview"><h1 id="hcertx-overview-overview">Overview</h1>
<p>The standard EU Digital COVID Credential system (HCERT) is not based on blockchain (at least for the moment).</p>
<p>The PrivacyCredentials system includes a blockchain-based implementation of the EU Digital COVID Certificates (EUDCC) specification called HCERTX which is an extension interoperable with the HCERT specification</p>
<p>The meaning of the above sentence is multiple. On the one hand, it means that the system is interoperable with the EU Digital COVID Certificates:</p>
<ul>
<li>The PrivacyCredentials wallet can scan and store any EUDCC QR code, and can coexist with credentials in other formats (e.g., W3C VC).</li>
<li>The wallet can display the human-readable information of a stored EUDCC, including its QR code in EUDCC format so it can be verified by any compatible verifier.</li>
<li>The PrivacyCredentials verifier can scan and verify any EUDCC certificate.</li>
</ul>
<p>But usage of EUDCC goes beyond the above:</p>
<ul>
<li>The system can issue and verify credentials using the same technical format as the "official" EUDCC credentials (vaccination, test, and recovery), the only difference being that the certificates would be signed by entities which not necessarily are in the trusted list maintained by the EU Member States.</li>
<li>Those additional certificates can be not only health-related (like in the Lanzarote CovidSafe project), but they can belong to any other use case in any field where the same strong-privacy guarantees are required.</li>
<li>The major difference is that the identities of the entities involved in the use case are managed in the blockchain, making the system easier to implement, more scalable and resilient.</li>
</ul>
<h2 id="hcertx-overview-relationship-with-eu-digital-covid-certificates">Relationship with EU Digital COVID Certificates</h2>
<p>To better describe the system, this scetion compares HCERTX with the "standard" EUDCC system. We use the information from the eHealth Network in the document <a href="https://ec.europa.eu/health/sites/health/files/ehealth/docs/trust-framework_interoperability_certificates_en.pdf">Interoperability of health certificates Trust framework</a>, describing its characteristics and the differences.</p>
<p>For the explanation of how PrivacyCred can complement and improve the proposed eHealth Network system, first we need to draw the proposed eHealth Trust Framework in a different but completely equivalent way, in the following figure.</p>
<figure class="figure-image">
  <img src="hcertx/ehealth_PKD.png" alt="EU PKD system">
  <figcaption>EU PKD system</figcaption>
</figure>

<p>In the standard eHealth Network system, each country uploads to a central service (operated by the EU Commission) the keys/certificates specific to that country, and downloads from that service the keys/certificates from all the other countries that use the system. In this way, the <strong>EU Public Key Directory/Gateway</strong> (EU PKD) helps the different countries to maintain in each country a database with all the keys/certificates for all authorised issuers.</p>
<p>When one verifier entity in a country needs to verify a certificate presented by a traveler, it can do so by checking against the local copy (meaning in the verification country) of all keys/certificates maintained via the replication mechanism described above.</p>
<p>There are several ways in which a blockchain-based system like PrivacyCred could add value without modifying the essential processes or safety of the proposed system.</p>
<h3 id="hcertx-overview-option-1">Option 1</h3>
<p>Regarding the list of authorised issuers, the eHealth Network system requires that for each country its list should be published on its PHA’s website (national backend server). In addition, the list may also be published through an open API.</p>
<p>In Option 1, in addition to publishing the list in the website it could be published in a blockchain. In that way, the list is hyper-replicated in a secure and tamper-resistant way in all the nodes of the blockchain network.</p>
<p>This facilitates secure verification by any entity (hotels, restaurants, etc) without overloading the website of the PHA. In other words, it implements a <strong>massively scalable and highly available read-only database for checking the keys/certificates of authorised issuers</strong>. The number of writes to the blockchain is very low (only writing when the list of authorised issuers changes), and the reads are performed locally in each of the nodes operated by each entity participating in the blockchain.</p>
<p>In a sense, it would be a mechanism complementary to the open API mechanism but cheaper, more available and more scalable.</p>
<h3 id="hcertx-overview-option-2">Option 2</h3>
<p>Similar to Option 1, but publishing the full EU list in the blockchain. This could be done by a given country using the database that it has using the EU PKD, or it could even be performed by the EU entity providing the PKD service (most probably the Commission, as it happens with the European Federation Gateway Service).</p>
<p>Please note that in Option 1, there could be several countries that coordinate with each other and publish their lists in the same way in the blockchain, creating a single read-only list for any entity that wants to verify certificates.</p>
<h3 id="hcertx-overview-other-options">Other options</h3>
<p>In the future, there could be more "ambitious" options. For example, when EBSI (European Blockchain Services Infrastructure) is in production, it could be used as a complement or even replacing completely the EU PKD centralised system. Each country would keep their sovereignty regarding managing their authorised issuers list, but the replication of that data across the EU could be simplified enormously using the EBSI blockchain network.</p>
<p>In the same way, there could be different "national" or even pan-european blockchain networks that could be used by countries to "disseminate" the master lists in a safe, cheap and available way.</p>
<p>The eHealth Network document mentions the <a href="https://www.icao.int/Security/FAL/PKD/Pages/default.aspx">ICAO PKD</a>, and in its own words (emphasis added):</p>
<div class="admonition quote">
<p class="admonition-title">ICAO PKD</p>
<p>The publication of a Master List enables other receiving States to obtain a set of CSCA certificates from a single source (the Master List issuer) rather than establish a direct bilateral exchange with each of the Issuing Authorities or organizations represented on that list. However, <strong>the more instances of a CSCA certificate that a receiving State acquires</strong> — whether through multiple Master Lists, bilateral exchange, or both — <strong>the more confident</strong> the receiving State can be that the CSCA certificate they are using for validation is authentic. In this respect, Master Lists contribute to building and improving trust based on CSCA certificates.</p>
</div>
<p>The blockchain-based PKD could coexist with the centralised PKD (at least while the centralised one is worthwhile), complementing it and providing in a secure way more places where the lists are available for verifiers.
For example, the current ICAO PKD service is hosted in identical systems within two geographically separate sites (location A being located in Berlin, Germany and location B being located in Abu Dhabi, United Arab Emirates). An operator location is additionally provided within the ICAO headquarters (being located in Montreal, Canada). The two hosting sites are designed so that each of them can take over the work of the other site should one of them fail.</p>
<h3 id="hcertx-overview-summary">Summary</h3>
<p>A blockchain-based system could provide several benefits, including:</p>
<ul>
<li>
<p>Greater resiliency by replicating in a simple and secure way the Master Lists and associated data.</p>
</li>
<li>
<p>Better scalability, as most of the operations in the PKD system are reads (for verifications). Using a blockchain the data is hyper-replicated in a tamper-resistant way in all the nodes of the network, and the verifications can be done to servers which are very close to the geographical location of the verifier.</p>
</li>
<li>
<p>An alternative method to the current download method for users of the PKD data. It is enough to operate a node in the blockchain network and the data is updated automatically when the central PKD repository is updated (assuming the update process includes updating the data in the blockchain). Nobody can tamper with the data and the history of the previous versions of the Master Lists are available if needed.</p>
</li>
</ul></section><section class="print-page" id="hcertx-containerformat"><h1 id="hcertx-containerformat-electronic-health-certificate-container-format">Electronic Health Certificate Container Format</h1>
<p>The Electronic Health Certificate Container Format (HCERT) is designed to provide a uniform and standardised vehicle for health certificates from different Issuers. The aim is to harmonise how these health certificates are represented, encoded and signed with the goal of facilitating interoperability.</p>
<p>When appropriate, we describe here the standard HCERT as used in the EU Digital COVID Certificate, and the extensions for the HCERTX certificate.</p>
<h2 id="hcertx-containerformat-cbor-web-token-cwt">CBOR Web Token (CWT)</h2>
<p>The certificate is structured and encoded as a CBOR with a COSE digital signature. This is commonly known as a "CBOR Web Token" (CWT), and is defined in <a href="https://tools.ietf.org/html/rfc8392">RFC 8392</a>. The actual health certificate data is transported in a <code>hcert</code> claim (as specified in <a href="https://www.iana.org/assignments/cwt/cwt.xhtml">CBOR Web Token (CWT) Claims</a>).</p>
<p>There may be in the future many types of Health Certificates transported in this <code>hcert</code> claim, but at this moment the EU Digital COVID Certificates (the three subtypes of Vaccination, test and Recovery), are assigned a sub-claim key <strong>1</strong> inside this 'hcert` claim.</p>
<p>The integrity and authenticity of origin of payload data MUST be verifiable by the Verifier. To provide this mechanism, the issuer MUST sign the CWT using an asymmetric electronic signature scheme as defined in the COSE specification (<a href="https://tools.ietf.org/html/rfc8152">RFC 8152</a>).</p>
<h3 id="hcertx-containerformat-cwt-structure-overview">CWT Structure Overview</h3>
<ul>
<li>
<p>Protected Header</p>
<ul>
<li>Signature Algorithm (<code>alg</code>, label <strong>1</strong>)</li>
<li>Key Identifier (<code>kid</code>, label <strong>4</strong>)</li>
</ul>
</li>
<li>
<p>Payload</p>
<ul>
<li>Issuer (<code>iss</code>, claim key <strong>1</strong>, optional, ISO 3166-1 alpha-2 of issuer)</li>
<li>Issued At (<code>iat</code>, claim key <strong>6</strong>)</li>
<li>Expiration Time (<code>exp</code>, claim key <strong>4</strong>)</li>
<li>
<p>Health Certificate (<code>hcert</code>, claim key <strong>-260</strong>)</p>
<ul>
<li>EU Digital Covid Certificate v1 (<code>eu_dcc_v1</code> aka <code>eu_dgc_v1</code>, claim key <strong>1</strong>)</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Signature</p>
</li>
</ul>
<p>As mentioned before, the EU Digital Covid Certificate v1 travels <strong>inside</strong> the generic <code>hcert</code> claim, which is a registered IANA claim (<a href="https://www.iana.org/assignments/cwt/cwt.xhtml">CBOR Web Token (CWT) Claims</a>). But the <code>hcert</code> claim can be used to transport other Health Certificates in the future.</p>
<h3 id="hcertx-containerformat-signature-algorithm">Signature Algorithm</h3>
<p>The Signature Algorithm (<code>alg</code>) parameter indicates what algorithm is used for creating the signature. It must meet or exceed current SOG-IT guidelines.</p>
<p>One primary and one secondary algorithm is defined. The secondary algorithm should only be used if the primary algorithm is not acceptable within the rules and regulations imposed on the implementer.</p>
<p>However, it is essential and of utmost importance for the security of the system that all implementations incorporate the secondary algorithm. For this reason, both the primary and the secondary algorithm MUST be implemented.</p>
<p>For this version of the specification, the SOG-IT set levels for the primary and secondary algorithms are:</p>
<ul>
<li>Primary Algorithm: The primary algorithm is Elliptic Curve Digital Signature Algorithm (ECDSA) as defined in (ISO/IEC 14888–3:2006) section 2.3, using the P–256 parameters as defined in appendix D (D.1.2.3) of (FIPS PUB 186–4) in combination with the SHA–256 hash algorithm as defined in (ISO/IEC 10118–3:2004) function 4.</li>
</ul>
<p>This corresponds to the COSE algorithm parameter <code>ES256</code>.</p>
<ul>
<li>Secondary Algorithm: The secondary algorithm is RSASSA-PSS as defined in (<a href="https://tools.ietf.org/html/rfc8230">RFC 8230</a>) with a modulus of 2048 bits in combination with the SHA–256 hash algorithm as defined in (ISO/IEC 10118–3:2004) function 4.</li>
</ul>
<p>This corresponds to the COSE algorithm parameter: <code>PS256</code>.</p>
<h3 id="hcertx-containerformat-key-identifier">Key Identifier</h3>
<p>The Key Identifier (<code>kid</code>) claim is used by Verifiers for selecting the correct public key from a list of keys pertaining to the Issuer (<code>iss</code>) Claim. Several keys may be used in parallel by an Issuer for administrative reasons and when performing key rollovers. The Key Identifier is not a security-critical field. For this reason, it MAY also be placed in an unprotected header if required. Verifiers MUST accept both options.  If both options are present, the Key Identifier in the protected header MUST be used.</p>
<p>Due to the shortening of the identifier (for space-preserving reasons) there is a slim but non-zero chance that the overall list of DSCs accepted by a validator may contain DSCs with duplicate <code>kid</code>s. For this reason, a verifier MUST check all DSCs with that <code>kid</code>, until a successful verification is achieved. If no DSC succeeds, a validation error is raised.</p>
<h3 id="hcertx-containerformat-issuer">Issuer</h3>
<p>In HCERT, the Issuer (<code>iss</code>) claim is a string value that MAY optionally hold the ISO 3166-1 alpha-2 Country Code of the entity issuing the health certificate. This claim can be used by a Verifier to identify which set of DSCs to use for validation. The Claim Key 1 is used to identify this claim.</p>
<p>HCERTX supports the HCERT format but adds the possibility to use in <code>iss</code> the DID corresponding to the Issuer entity, with the W3C Verifiable Credentials format. On issuance the system uses the ELSI DID Method, as described later. On verification, the system can accept several DID Methods for resolution of the DID into the DID Document, most notably EBSI and AlastriaID. Resolution could be extended to any DID Method that provides a <strong>Universal Resolver interface</strong>. </p>
<h3 id="hcertx-containerformat-expiration-time">Expiration Time</h3>
<p>The Expiration Time (<code>exp</code>) claim SHALL hold a timestamp in the integer NumericDate format (as specified in <a href="https://tools.ietf.org/html/rfc8392">RFC 8392</a> section 2) indicating for how long this particular signature over the Payload SHALL be considered valid, after which a Verifier MUST reject the Payload as expired. The purpose of the expiry parameter is to force a limit of the validity period of the health certificate. The Claim Key 4 is used to identify this claim.</p>
<p>The Expiration Time MUST not exceed the validity period of the DSC.</p>
<h3 id="hcertx-containerformat-issued-at">Issued At</h3>
<p>The Issued At (<code>iat</code>) claim SHALL hold a timestamp in the integer NumericDate format (as specified in <a href="https://tools.ietf.org/html/rfc8392">RFC 8392</a> section 2) indicating the time when the health certificate was created. </p>
<p>The Issued At field MUST not predate the validity period of the DSC.</p>
<p>Verifiers MAY apply additional policies with the purpose of restricting the validity of the health certificate based on the time of issue. The Claim Key 6 is used to identify this claim.</p>
<h3 id="hcertx-containerformat-health-certificate-claim">Health Certificate Claim</h3>
<p>The Health Certificate (<code>hcert</code>) claim is a JSON (<a href="https://tools.ietf.org/html/rfc7159">RFC 7159</a>) object containing the health status information, represented in CBOR as a <em>map</em>. It is registered as claim key <strong>-260</strong> in the IANA claim registry (<a href="https://www.iana.org/assignments/cwt/cwt.xhtml">CBOR Web Token (CWT) Claims</a>). Several different types of health certificate MAY exist under the same claim, of which the European Digital COVID Certificate is one.</p>
<p>Note here that the JSON is purely for schema purposes. The wire format is CBOR as defined in (<a href="https://tools.ietf.org/html/rfc7049">RFC 7049</a>). Application developers may not actually ever decode or encode to and from the JSON format, but use the in-memory structure.</p>
<p>Strings in the JSON object SHOULD be <a href="http://www.unicode.org/reports/tr15/#Norm_Forms">NFC normalised according to the Unicode standard</a>. Decoding applications SHOULD however be permissive and robust in these aspects, and acceptance of any reasonable type conversion is strongly encouraged. If non-normalised data is found during decoding, or in subsequent comparison functions, implementations SHOULD behave as if the input is normalised to NFC.</p>
<h2 id="hcertx-containerformat-transport-encodings">Transport Encodings</h2>
<h3 id="hcertx-containerformat-raw">Raw</h3>
<p>For arbitrary data interfaces the HCERT container and its payloads may be transferred as-is, utilising any underlying, 8 bit safe, reliable data transport. These interfaces MAY include NFC, Bluetooth or transfer over an application layer protocol, for example transfer of an HCERT from the Issuer to a holder’s mobile device.</p>
<p>If the transfer of the HCERT from the Issuer to the holder is based on a presentation-only interface (e.g., SMS, e-mail), the Raw transport encoding is obviously not applicable.</p>
<h3 id="hcertx-containerformat-barcode">Barcode</h3>
<figure class="figure-image">
  <img src="hcertx/container_overview.png" alt="Overview: QR code generation and verification">
  <figcaption>Overview: QR code generation and verification</figcaption>
</figure>

<h4 id="hcertx-containerformat-payload-cwt-compression">Payload (CWT) Compression</h4>
<p>To lower size and to improve speed and reliability in the reading process of the HCERT, the CWT SHALL be compressed using ZLIB (<a href="https://tools.ietf.org/html/rfc1950">RFC 1950</a>) and the Deflate compression mechanism in the format defined in (<a href="https://tools.ietf.org/html/rfc1951">RFC 1951</a>). </p>
<h4 id="hcertx-containerformat-qr-2d-barcode">QR 2D Barcode</h4>
<p>In order to better handle legacy equipment designed to operate on ASCII payloads, the compressed CWT is encoded as ASCII using <a href="https://datatracker.ietf.org/doc/draft-faltstrom-base45">Base45</a> before being encoded into a 2D barcode.</p>
<p>The QR format as defined in (<a href="https://www.iso.org/standard/62021.html#:~:text=ISO%2FIEC%2018004%3A2015%20defines%20the%20requirements%20for%20the%20symbology,algorithm%2C%20production%20quality%20requirements%2C%20and%20user-selectable%20application%20parameters.">ISO/IEC 18004:2015</a>) SHALL be used for 2D barcode generation. An error correction rate of ‘Q’ (around 25%) is RECOMMENDED.  The Alphanumeric (Mode 2/QR Code symbols 0010) MUST be used in conjunction with Base45. </p>
<p>In order for Verifiers to be able to detect the type of data encoded and to select the proper decoding and processing scheme, the base45 encoded data (as per this specification) SHALL be prefixed by the Context Identifier string <code>HC1:</code>. Future versions of this specification that impact backwards-compatibility SHALL define a new Context Identifier, whereas the character following <code>HC</code> SHALL be taken from the character set [1-9A-Z]. The order of increments is defined to be in that order, i.e., first [1-9] and then [A-Z].</p>
<p>The optical code is RECOMMENDED to be rendered on the presentation media with a diagonal size between 35 mm and 60 mm to accommodate readers with fixed optics where the presentation media is required to be placed on the surface of the reader.</p>
<p>If the optical code is printed on paper using low-resolution (&lt; 300 dpi) printers, care must be taken to represent each symbol (dot) of the QR code exactly square. Non-proportional scaling will result in some rows or columns in the QR having rectangular symbols, which will hamper readability in many cases.</p></section><section class="print-page" id="hcertx-datamodel"><h1 id="hcertx-datamodel-eu-digital-covid-credentials">EU Digital COVID Credentials</h1>
<p>The system supports the <strong>EU Digital COVID Credentials</strong> both for storing and verifying them with the wallet and verifier applications.
The system supports generating credentials using exactly the same format as the <code>EU Digital COVID Credential</code>, but in our case the public keys are stored in the blockchain, together with the identities of all entities authorised to issue credentials.</p>
<p>The format and interoperability guidelines are defined in the related documentation from the EU. A brief summary (which should not be considered authoritative) follows.</p>
<h2 id="hcertx-datamodel-common-structure-of-eudcc">Common structure of EUDCC</h2>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;ver&quot;</span><span class="p">:</span> <span class="err">&lt;versio</span><span class="kc">n</span> <span class="err">i</span><span class="kc">nf</span><span class="err">orma</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">&gt;</span><span class="p">,</span>
    <span class="nt">&quot;nam&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="err">&lt;perso</span><span class="kc">n</span> <span class="kc">na</span><span class="err">me</span> <span class="err">i</span><span class="kc">nf</span><span class="err">orma</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">&gt;</span>
    <span class="p">},</span>
    <span class="nt">&quot;dob&quot;</span><span class="p">:</span> <span class="err">&lt;da</span><span class="kc">te</span> <span class="err">o</span><span class="kc">f</span> <span class="err">bir</span><span class="kc">t</span><span class="err">h&gt;</span><span class="p">,</span>
    <span class="s2">&quot;v&quot;</span> <span class="err">or</span> <span class="s2">&quot;t&quot;</span> <span class="err">or</span> <span class="nt">&quot;r&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="err">&lt;vacci</span><span class="kc">nat</span><span class="err">io</span><span class="kc">n</span> <span class="err">dose</span> <span class="err">or</span> <span class="kc">test</span> <span class="err">or</span> <span class="err">recovery</span> <span class="err">i</span><span class="kc">nf</span><span class="err">orma</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="p">,</span> <span class="err">o</span><span class="kc">ne</span> <span class="err">e</span><span class="kc">ntr</span><span class="err">y&gt;</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="hcertx-datamodel-version">Version</h3>
<p>Version information MUST be provided. Versioning is following Semantic Versioning (semver: 
https://semver.org). In production, it MUST be one of the officially released (current or one of the older 
officially released) versions. See Section JSON Schema location for more details.</p>
<table>
<thead>
<tr>
<th>Field id</th>
<th>Field name</th>
<th>Instructions</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ver</strong></td>
<td>Schema version</td>
<td>MUST match the identifier of the schema version used for producing the EUDCC. Example: "ver": "1.3.0</td>
</tr>
</tbody>
</table>
<h3 id="hcertx-datamodel-person-name-and-date-of-birth">Person name and date of birth</h3>
<p>Person name is the official full name of the person, matching the name stated on travel documents. The 
identifier of the structure is nam. Exactly 1 (one) person name MUST be provided.</p>
<table>
<thead>
<tr>
<th>Field id</th>
<th>Field name</th>
<th>Instructions</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>nam.fn</strong></td>
<td>Surname(s)</td>
<td>Surname(s), such as family name(s), of the holder.<br>Exactly 1 (one) non-empty field MUST be provided, with all surnames included in it. In case of multiple surnames, these MUST be separated by a space. Combination names including hyphens or similar characters must however <br>stay the same.<br>Examples:<br>"fn": "Musterfrau-Gößinger"<br>"fn": "Musterfrau-Gößinger Müller"</td>
</tr>
<tr>
<td><strong>nam.fnt</strong></td>
<td>Standardised surname(s)</td>
<td>Surname(s) of the holder transliterated using the same convention as the one used in the holder’s machine readable travel documents (such as the rules defined in ICAO Doc 9303 Part 3).<br>Exactly 1 (one) non-empty field MUST be provided, only including characters A-Z and "&lt;". Maximum length: 80 characters (as per ICAO 9303 specification).<br>Examples:<br>"fnt": "MUSTERFRAU&lt;GOESSINGER"<br>"fnt": "MUSTERFRAU&lt;GOESSINGER&lt;MUELLER"</td>
</tr>
<tr>
<td><strong>nam.gn</strong></td>
<td>Forename(s)</td>
<td>Forename(s), such as given name(s), of the holder.<br>If the holder has no forenames, the field MUST be skipped.<br>In all other cases, exactly 1 (one) non-empty field MUST be provided, with all forenames included in it. In case of multiple forenames, these MUST be separated by a space.<br>Example:<br>"gn": "Isolde Erika"</td>
</tr>
<tr>
<td><strong>nam.gnt</strong></td>
<td>Standardised forename(s)</td>
<td>Forename(s) of the holder transliterated using the same convention as the one used in the holder’s machine readable travel documents (such as the rules defined in ICAO Doc 9303 Part 3).<br>If the holder has no forenames, the field MUST be skipped.<br>In all other cases, exactly 1 (one) non-empty field MUST be provided, only including characters A-Z and "&lt;".<br>Maximum length: 80 characters.<br>Example:<br>"gnt": "ISOLDE&lt;ERIKA"</td>
</tr>
<tr>
<td><strong>dob</strong></td>
<td>Date of birth</td>
<td>Date of birth of the DCC holder.<br>Complete or partial date without time restricted to the range from 1900-01-01 to 2099-12-31. <br>Exactly 1 (one) non-empty field MUST be provided if the complete or partial date of birth is known. If the date of birth is not known even partially, the field MUST be set to an empty string "". This should match the information as provided on travel documents.<br>One of the following ISO 8601 formats MUST be used if information on date of birth is available. Other options are not supported. <br>YYYY-MM-DD<br>YYYY-MM<br>YYYY<br>(The verifier app may show missing parts of the date of birth using the XX convention as the one used in machinereadable travel documents, e.g. 1990-XX-XX.)<br>Examples:<br>"dob": "1979-04-14"<br>"dob": "1901-08"<br>"dob": "1939"<br>"dob": ""</td>
</tr>
</tbody>
</table>
<h3 id="hcertx-datamodel-groups-for-certificate-type-specific-information">Groups for certificate type specific information</h3>
<p>The JSON Schema supports three groups of entries encompassing certificate type specific information. 
Each EUDCC MUST contain exactly 1 (one) group. Empty groups are not allowed.</p>
<table>
<thead>
<tr>
<th>Group identifier</th>
<th>Group name</th>
<th>Entries</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>v</strong></td>
<td>Vaccination group</td>
<td>If present, MUST contain exactly 1 (one) entry describing exactly 1 (one) vaccination dose.</td>
</tr>
<tr>
<td><strong>t</strong></td>
<td>Test group</td>
<td>If present, MUST contain exactly 1 (one) entry describing exactly 1 (one) test result.</td>
</tr>
<tr>
<td><strong>r</strong></td>
<td>Recovery group</td>
<td>If present, MUST contain exactly 1 (one) entry describing 1 (one) recovery statement.</td>
</tr>
</tbody>
</table>
<h2 id="hcertx-datamodel-certificate-type-specific-information">Certificate type specific information</h2>
<h3 id="hcertx-datamodel-vaccination-certificate">Vaccination certificate</h3>
<p>Vaccination group, if present, MUST contain exactly 1 (one) entry describing exactly one vaccination 
event. All elements of the vaccination group are mandatory, empty values are not supported.</p>
<table>
<thead>
<tr>
<th>Field id</th>
<th>Field name</th>
<th>Instructions</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>v.tg</strong></td>
<td>Disease or agent targeted: COVID-19 (SARS-CoV or one of its variants)</td>
<td>A coded value from the value set <code>disease-agent-targeted.json</code>.<br>This value set has a single entry 840539006, which is the code for COVID-19 from SNOMED CT (GPS).<br>Exactly 1 (one) non-empty field MUST be provided.<br>Example:<br>"tg": "840539006"</td>
</tr>
<tr>
<td><strong>v.vp</strong></td>
<td>COVID-19 vaccine or prophylaxis</td>
<td>Type of the vaccine or prophylaxis used.<br>A coded value from the value set <code>vaccine-prophylaxis.json</code>.<br>The value set will be distributed from the EUDCC Gateway starting with the gateway version 1.1.<br>Exactly 1 (one) non-empty field MUST be provided.<br>Example:<br>"vp": "1119349007" (a SARS-CoV-2 mRNA vaccine)</td>
</tr>
<tr>
<td><strong>v.mp</strong></td>
<td>COVID-19 vaccine product</td>
<td>Medicinal product used for this specific dose of vaccination. A coded value from the value set <code>vaccine-medicinal-product.json</code>.<br>The value set will be distributed from the EUDCC Gateway starting with the gateway version 1.1.<br>Exactly 1 (one) non-empty field MUST be provided.<br>Example:<br>"mp": "EU/1/20/1528" (Comirnaty)</td>
</tr>
<tr>
<td><strong>v.ma</strong></td>
<td>COVID-19 vaccine marketing authorisation holder or manufacturer</td>
<td>Marketing authorisation holder or manufacturer, if no marketing authorization holder is present.<br>A coded value from the value set <code>vaccine-mah-manf.json</code>.<br>The value set will be distributed from the EUDCC Gateway starting with the gateway version 1.1.<br>Exactly 1 (one) non-empty field MUST be provided.<br>Example:<br>"ma": "ORG-100030215" (Biontech Manufacturing GmbH)</td>
</tr>
<tr>
<td><strong>v.dn</strong></td>
<td>Number in a series of doses</td>
<td>Sequence number (positive integer) of the dose given during this vaccination event. 1 for the first dose, 2 for the second dose etc.<br>Exactly 1 (one) non-empty field MUST be provided.<br>Examples:<br>"dn": "1" (first dose in a series)<br>"dn": "2" (second dose in a series)<br>"dn": "3" (third dose in a series, such as in case of a booster)</td>
</tr>
<tr>
<td><strong>v.sd</strong></td>
<td>The overall number of doses in the series</td>
<td>Total number of doses (positive integer) in a complete vaccination series according to the used vaccination protocol. The protocol is not in all cases directly defined by the vaccine product, as in some countries only one dose of normally two-dose vaccines is delivered to people recovered from COVID19. In these cases, the value of the field should be set to 1.<br>Exactly 1 (one) non-empty field MUST be provided.<br>Examples:<br>"sd": "1" (for all 1-dose vaccination schedules)<br>"sd": "2" (for 2-dose vaccination schedules)<br>"sd": "3" (in case of a booster)</td>
</tr>
<tr>
<td><strong>v.dt</strong></td>
<td>Date of vaccination</td>
<td>The date when the described dose was received, in the format YYYY-MM-DD (full date without time). Other formats are not supported.<br>Exactly 1 (one) non-empty field MUST be provided.<br>Example:<br>"dt": "2021-03-28"</td>
</tr>
<tr>
<td><strong>v.co</strong></td>
<td>Member State or third country in which the vaccine was administered</td>
<td>Country expressed as a 2-letter ISO3166 code (RECOMMENDED) or a reference to an international organisation responsible for the vaccination event (such as UNHCR or WHO). A coded value from the value set <code>country-2-codes.json</code>.<br>The value set will be distributed from the EUDCC Gateway starting with the gateway version 1.1.<br>Exactly 1 (one) field MUST be provided.<br>Example:<br>"co": "CZ"<br>"co": "UNHCR"</td>
</tr>
<tr>
<td><strong>v.is</strong></td>
<td>Certificate issuer</td>
<td>Name of the organisation that issued the certificate. Identifiers are allowed as part of the name, but not recommended to be used individually without the name as a text. Max 80 UTF-8 characters.<br>Exactly 1 (one) non-empty field MUST be provided.<br>Example:<br>"is": "Ministry of Health of the Czech Republic"<br>"is": "Vaccination Centre South District 3"</td>
</tr>
<tr>
<td><strong>v.ci</strong></td>
<td>Unique certificate identifier</td>
<td>HCERT: Unique certificate identifier (UVCI) as specified in the vaccinationproof_interoperability-guidelines_en.pdf (europa.eu)<br>The inclusion of the checksum is optional. The prefix "URN:UVCI:" may be added.<br>Exactly 1 (one) non-empty field MUST be provided.<br>Examples:<br>"ci": "URN:UVCI:01:NL:187/37512422923"<br>"ci": "URN:UVCI:01:AT:10807843F94AEE0EE5093FBC254BD813#B"<br><br>HCERTX: UUID version 4 (see below)</td>
</tr>
</tbody>
</table>
<p><strong>HCERTX and the Unique certificate identifier (UVCI)</strong>: In the EU HCERT the UVCI identifier is structured, reducing the anonymity features of the identifier and introducing some problems in certificate revocation, especially in relation with personal data regulations. This is the reason why a short HCERT Signature Validity Time is required, and requires the holder of a health certificate to renew it at periodic intervals.</p>
<p>In HCERTX the UVCI is a <strong>U</strong>niversally <strong>U</strong>nique <strong>ID</strong>entifier version 4 (UUID) as defined in <a href="https://datatracker.ietf.org/doc/html/rfc4122#section-4.4">RFC 4122</a>. This UUID is completely urelated to the rest of the information in the credential and reduces the possibility of many types of attacks. This UUID can be used to implement efficient revocation lists without it ever becoming personal information.</p>
<h3 id="hcertx-datamodel-test-certificate">Test certificate</h3>
<p>Test group, if present, MUST contain exactly 1 (one) entry describing exactly one test result.</p>
<table>
<thead>
<tr>
<th>Field id</th>
<th>Field name</th>
<th>Instructions</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>t.tg</strong></td>
<td>Disease or agent targeted: COVID-19 (SARS-CoV or one of its variants)</td>
<td>A coded value from the value set <code>disease-agent-targeted.json</code>.<br>This value set has a single entry 840539006, which is the code for COVID-19 from SNOMED CT (GPS).<br>Exactly 1 (one) non-empty field MUST be provided.<br>Example:<br>"tg": "840539006"</td>
</tr>
<tr>
<td><strong>t.tt</strong></td>
<td>The type of test</td>
<td>The type of the test used, based on the material targeted by the test. A coded value from the value set <code>test-type.json</code> (based on LOINC). Values outside of the value set are not allowed.<br>Exactly 1 (one) non-empty field MUST be provided.<br>Example:<br>"tt": "LP6464-4" (Nucleic acid amplification with probe detection)<br>"tt": "LP217198-3" (Rapid immunoassay)</td>
</tr>
<tr>
<td><strong>t.nm</strong></td>
<td>Test name (nucleic acid amplification tests only)</td>
<td>The name of the nucleic acid amplification test (NAAT) used. The name should include the name of the test manufacturer and the commercial name of the test, separated by a comma.<br>For NAAT: the field is optional.<br>For RAT: the field SHOULD NOT be used, as the name of the test is supplied indirectly through the test device identifier (t/ma).<br>When supplied, the field MUST NOT be empty.<br>Example:<br>"nm": "ELITechGroup, SARS-CoV-2 ELITe MGB® Kit"</td>
</tr>
<tr>
<td><strong>t.ma</strong></td>
<td>Test device identifier (rapid antigen tests only)</td>
<td>Rapid antigen test (RAT) device identifier from the JRC database. Value set (HSC common list):<br><ul><li><a href="https://covid-19-diagnostics.jrc.ec.europa.eu/devices?manufacturer&amp;text_name&amp;marking&amp;rapid_diag&amp;format&amp;target_type&amp;field-1=HSC%20common%20list%20%28RAT%29&amp;value-1=1&amp;search_method=AND#form_content">All Rapid antigen tests in HSC common list</a> (human readable).</li><li><a href="https://covid-19-diagnostics.jrc.ec.europa.eu/devices/hsc-common-recognition-rat">https://covid-19-diagnostics.jrc.ec.europa.eu/devices/hsc-common-recognition-rat</a> (machine-readable, values of the field id_device included on the list form the value set).</li></ul>In EU/EEA countries, issuers MUST only issue certificates for tests belonging to the currently valid value set. The value set MUST be updated every 24 hours.<br>Values outside of the value set MAY be used in certificates issued by third countries, however the identifiers MUST still be from the JRC database. The use of other identifiers such as those provided directly by test manufacturers is not permitted.<br>Verifiers MUST detect values not belonging to the up to date value set and render certificates bearing these as invalid. If an identifier is removed from the value set, certificates including it MAY be accepted for a maximum of 72 hours after the removal.<br>The value set will be distributed from the EUDCC Gateway starting with the gateway version 1.1.<br>For RAT: exactly 1 (one) non-empty field MUST be provided.<br>For NAAT: the field MUST NOT be used, even if the NAA test identifier is available in the JRC database.<br>Example:<br>"ma": "344" (SD BIOSENSOR Inc, STANDARD F COVID-19 Ag FIA)</td>
</tr>
<tr>
<td><strong>t.sc</strong></td>
<td>Date and time of the test sample collection</td>
<td>The date and time when the test sample was collected. The time MUST include information on the time zone. The value MUST NOT denote the time when the test result was produced.<br>Exactly 1 (one) non-empty field MUST be provided.<br>One of the following ISO 8601 formats MUST be used. Other options are not supported.<br>YYYY-MM-DDThh:mm:ssZ<br>YYYY-MM-DDThh:mm:ss[+-]hh<br>YYYY-MM-DDThh:mm:ss[+-]hhmm<br>YYYY-MM-DDThh:mm:ss[+-]hh:mm<br>Examples:<br>"sc": "2021-08-20T10:03:12Z" (UTC time)<br>"sc": "2021-08-20T12:03:12+02" (CEST time)<br>"sc": "2021-08-20T12:03:12+0200" (CEST time)<br>"sc": "2021-08-20T12:03:12+02:00" (CEST time)</td>
</tr>
<tr>
<td><strong>t.tr</strong></td>
<td>Result of the test</td>
<td>The result of the test. A coded value from the value set <code>test-result.json</code> (based on SNOMED CT, GPS).<br>Exactly 1 (one) non-empty field MUST be provided.<br>Example:<br>"tr": "260415000" (Not detected)</td>
</tr>
<tr>
<td><strong>t.tc</strong></td>
<td>Testing centre or facility</td>
<td>Name of the actor that conducted the test. Identifiers are allowed as part of the name, but not recommended to be used individually without the name as a text. Max 80 UTF-8 characters. Any extra characters should be truncated. The name is not designed for automated verification.<br>For NAAT tests: exactly 1 (one) non-empty field MUST be provided.<br>For RAT tests: the field is optional. If provided, MUST NOT be empty.<br>Example:<br>"tc": "Test centre west region 245"</td>
</tr>
<tr>
<td><strong>t.co</strong></td>
<td>Member State or third country in which the test was carried out</td>
<td>Country expressed as a 2-letter ISO3166 code (RECOMMENDED) or a reference to an international organisation responsible for carrying out the test (such as UNHCR or WHO). This MUST be a coded value from the value set <code>country-2-codes.json</code>.<br>The value set will be distributed from the EUDCC Gateway starting with the gateway version 1.1.<br>Exactly 1 (one) field MUST be provided.<br>Examples:<br>"co": "CZ"<br>"co": "UNHCR"</td>
</tr>
<tr>
<td><strong>t.is</strong></td>
<td>Certificate issuer</td>
<td>Name of the organisation that issued the certificate. Identifiers are allowed as part of the name, but not recommended to be used individually without the name as a text. Max 80 UTF-8 characters.<br>Exactly 1 (one) non-empty field MUST be provided.<br>Examples:<br>"is": "Ministry of Health of the Czech Republic"<br>"is": "North-West region health authority"</td>
</tr>
<tr>
<td><strong>t.ci</strong></td>
<td>Unique certificate identifier</td>
<td>HCERT: Unique certificate identifier (UVCI) as specified in the vaccinationproof_interoperability-guidelines_en.pdf (europa.eu)<br>The inclusion of the checksum is optional. The prefix "URN:UVCI:" may be added.<br>Exactly 1 (one) non-empty field MUST be provided.<br>Examples:<br>"ci": "URN:UVCI:01:NL:187/37512422923"<br>"ci": "URN:UVCI:01:AT:10807843F94AEE0EE5093FBC254BD813#B"<br><br>HCERTX: UUID version 4 (see below)</td>
</tr>
</tbody>
</table>
<p><strong>HCERTX and the Unique certificate identifier (UVCI)</strong>: In the EU HCERT the UVCI identifier is structured, reducing the anonymity features of the identifier and introducing some problems in certificate revocation, especially in relation with personal data regulations. This is the reason why a short HCERT Signature Validity Time is required, and requires the holder of a health certificate to renew it at periodic intervals.</p>
<p>In HCERTX the UVCI is a <strong>U</strong>niversally <strong>U</strong>nique <strong>ID</strong>entifier version 4 (UUID) as defined in <a href="https://datatracker.ietf.org/doc/html/rfc4122#section-4.4">RFC 4122</a>. This UUID is completely urelated to the rest of the information in the credential and reduces the possibility of many types of attacks. This UUID can be used to implement efficient revocation lists without it ever becoming personal information.</p>
<h3 id="hcertx-datamodel-recovery-certificate">Recovery certificate</h3>
<p>Recovery group, if present, MUST contain exactly 1 (one) entry describing exactly one recovery 
statement. All elements of the recovery group are mandatory, empty values are not supported.</p>
<p>Its specification is not detailed here, but you can get it from the official eHealth site.</p></section><section class="print-page" id="hcertx-trustedlists"><h1 id="hcertx-trustedlists-trusted-list-format-dsc-list">Trusted List Format (DSC list)</h1>
<h2 id="hcertx-trustedlists-in-hcert">In HCERT</h2>
<p>In HCERT the Trusted List is managed as described in the following diagram.</p>
<figure class="figure-image">
  <img src="hcertx/ehealth_PKD.png" alt="Trusted Lists replication">
  <figcaption>Trusted Lists replication</figcaption>
</figure>

<p>Each Participating country is REQUIRED to provide a list of one or more Certificate Signing Certificate Authorities (CSCAs) and a list of all valid Document Signing Certificates (DSCs), and keep these lists current. The country lists are replicated to the other countries via the centralised EU Public Key Directory/Gateway service.</p>
<p>For the list of CSCA certificates, each certificate:</p>
<ul>
<li>MUST contain a valid Country attribute in the subject DN that matches the country of issuance.</li>
<li>MUST contain DN that is unique within the specified country.</li>
<li>MUST contain a unique Subject Key Identifier (SKI) according to (<a href="https://tools.ietf.org/html/rfc5280">RFC5280</a>).</li>
</ul>
<p>In addition, for the list of DSC certificates, each certificate:</p>
<ul>
<li>MUST be signed with the private key corresponding to a CSCA certificate published on the aforementioned list.</li>
<li>MUST contain an Authority Key Identifier (AKI) matching the Subject Key Identifier (SKI) of the issuing CSCA certificate.</li>
<li>MUST have a validity period that is in line with or longer than the validity period of all certificates signed using that key.</li>
<li>SHOULD contain a unique Subject Key Identifier derived from the subject public key.</li>
</ul>
<h3 id="hcertx-trustedlists-simplified-cscadsc">Simplified CSCA/DSC</h3>
<p>As of this version of the specifications, countries should NOT assume that any Certificate Revocation List (CRL) information is used; or that the Private Key Usage Period is verified by implementers.</p>
<p>Instead, the <strong>primary validity mechanism is the presence of the certificate on the most recent version of that certificate list</strong>.</p>
<h3 id="hcertx-trustedlists-icao-emrtd-pki-and-trust-centers">ICAO eMRTD PKI and Trust Centers</h3>
<p>Member States can use a separate CSCA (as per the WHO advice) but may also submit their existing eMRT CSCA and/or DSC certificates; and may even choose to procure these from (commercial) TSPs - and submit these. However, any DSC certificate must always be signed by the CSCA submitted by that country.</p>
<h2 id="hcertx-trustedlists-in-hcertx">In HCERTX</h2>
<p>In HCERTX the Document Signing Certificates (DSCs) are managed in a Trusted List implemented as a set of Smart Contracts deployed in one or more blockchain networks. This is described in more detail in the section <a href="#trustframework-tf-overview">Trusted Framework</a>.
The Trusted List includes not only the DSCs but also additional information about the public identities of the entities authorised to issue certificates. Replication of all the required information across all participants is performed automatically by the blockchain.</p>
<p>Thanks to the secure decentralised management of the Trusted List, HCERTX allows certificates to be issued (and signed) directly by the laboratories, making the whole system much more efficient and still secure and well-managed.  </p>
<p>As in HCERT, the <strong>primary validity mechanism is the presence of the certificate on the most recent version of that certificate list</strong>. The difference is that the list is managed in the blockchain, so the last version of the list is always updated automatically in all nodes of the network.</p></section><section class="print-page" id="hcertx-security-considerations"><h1 id="hcertx-security-considerations-security-and-trust-management-considerations">Security and Trust Management considerations</h1>
<h2 id="hcertx-security-considerations-security-considerations">Security Considerations</h2>
<p>When designing a scheme using this specification, several important security aspects must be considered. These cannot preemptively be accounted for in this specification but must be identified, analysed and monitored by the Participants.</p>
<p>As input to the continuous analysis and monitoring of risks, the following topics SHOULD be taken into account:</p>
<h3 id="hcertx-security-considerations-hcert-signature-validity-time">HCERT Signature Validity Time</h3>
<h4 id="hcertx-security-considerations-in-hcert">In HCERT</h4>
<p>It is anticipated that health certificates can not be reliably revoked once issued, especially not if this specification would be used on a global scale. Publishing of revocation information containing identifiers may also create privacy concerns, as this information is per definition Personally Identifiable Information (PII). For these reasons, this specification requires the Issuer of HCERTs to limit the validity period of the signature by specifying a signature expiry time. This requires the holder of a health certificate to renew it at periodic intervals. </p>
<p>The acceptable validity period may be determined by practical constraints. For example, a traveller may not have the possibility to renew the health certificate during a trip overseas. However, it may also be the case that an Issuer is considering the possibility of a security compromise of some sort, which requires the Issuer to withdraw an DSC (invalidating all health certificates issued using that key which are still within their validity period). The consequences of such an event may be limited by regularly rolling Issuer keys and requiring renewal of all health certificates, on some reasonable interval.</p>
<h4 id="hcertx-security-considerations-in-hcertx">In HCERTX</h4>
<p>As described in the section on data model, the UVCI identifier is completely anonymous and can be used for secure and efficient implementation of revocation lists of certificates. That means that the decision of the certificate validity period can be taken based on the actual intended usage of the certificate and not because the security issue that happens in the HCERT implementation. </p>
<h3 id="hcertx-security-considerations-key-management">Key Management</h3>
<p>This specification relies heavily on strong cryptographic mechanisms to secure data integrity and data origin authentication. Maintaining the confidentiality of the private keys is therefore of utmost importance.</p>
<p>The confidentiality of cryptographic keys can be compromised in a number of different ways, for instance:</p>
<ul>
<li>The key generation process may be flawed, resulting in weak keys.</li>
<li>The keys may be exposed by human error.</li>
<li>The keys may be stolen by external or internal perpetrators.</li>
<li>The keys may be calculated using cryptanalysis.</li>
</ul>
<p>To mitigate against the risks that the signing algorithm is found to be weak, allowing the private keys to be compromised through cryptanalysis, this specification recommends all Participants to implement a secondary fallback signature algorithm based on different parameters or a different mathematical problem than the primary.</p>
<p>The other risks mentioned here are related to the Issuers' operating environments. One effective control to mitigate significant parts of these risks is to generate, store and use the private keys in Hardware Security Modules (HSMs). Use of HSMs for signing health certificates is highly encouraged.</p>
<p>However, regardless of whether an Issuer decides to use HSMs or not, a key roll-over schedule SHOULD be established where the frequency of the key roll-overs is proportionate to the exposure of keys to external networks, other systems and personnel. A well-chosen roll-over schedule also limits the risks associated with erroneously issued health certificates, enabling an Issuer to revoke such health certificates in batches, by withdrawing a key, if required.</p>
<h3 id="hcertx-security-considerations-input-data-validation">Input Data Validation</h3>
<p>This specification may be used in a way that implies receiving data from untrusted sources into systems that may be of mission-critical nature. To minimise the risks associated with this attack vector, all input fields MUST be properly validated by data types, lengths and contents. The Issuer Signature SHALL also be verified before any processing of the contents of the HCERT takes place. However, the validation of the Issuer Signature implies parsing the Protected Issuer Header first, in which a potential attacker may attempt to inject carefully crafted information designed to compromise the security of the system.</p>
<h2 id="hcertx-security-considerations-trust-management">Trust Management</h2>
<p>The signature of the HCERT requires a public key to verify. Countries, or institutions within countries, need to make these public keys available. Ultimately, every Verifier needs to have a list of all public keys it is willing to trust (as the public key is not part of the HCERT).</p>
<h3 id="hcertx-security-considerations-list-of-public-keys">List of public keys</h3>
<h4 id="hcertx-security-considerations-in-hcert_1">In HCERT</h4>
<p>In HCERT, a simplified variation on the ICAO "<em>Master list</em>" will be used, tailored to this health certificate application, whereby each country is ultimately responsible for compiling their own master list and making that available to the other Participants. The aid of a coordinating Secretariat for operational and practical purposes will be available.</p>
<p>The <em>"Secretariat"</em> is a functional role; not a person or a piece of software. It is expected that the Digital Covid Certificate Gateway (DCCG) will automate most of these tasks.</p>
<p>The system consists of (only) two layers; for each Member State one or more country level certificates that each signs one or more document signing certificates that are used in day to day operations.</p>
<p>The Member State certificates are called Certificate Signer Certificate Authorities (CSCAs) and are (typically) self-signed certificates. Countries may have more than one (e.g., in case of regional devolution). These CSCA certificates regularly sign the Document Signing Certificates (DSCs) used for signing HCERTs. Member States will each maintain a public register of the DSC certificates that is kept current, communicated to the Secretariat and also published at a stable URL for bilateral exchange. Member States MUST remove any revoked or stale certificates from this list.</p>
<p>The Secretariat will regularly aggregate and publish the Member States DSCs, after having verified these against the list of CSCA certificates (which have been conveyed and verified by other means). </p>
<p>The resulting list of DSC certificates then provides the aggregated set of acceptable public keys (and the corresponding <code>kid</code>s) that Verifiers can use to validate the signatures over the HCERTs. Verifiers MUST fetch and update this list regularly.</p>
<p>Member States may also bilaterally exchange CSCA certificates with a number of other Member States, verify these bilaterally and thus compile their own lists of CSCA and DSC certificates which is specific to that Member State. Verifiers may choose to rely on such a national list.</p>
<p>Such Member State-specific lists are expected to be adapted in the format for their own national setting. As such, the file format of this trusted list may vary, e.g., it can be a signed JWKS (<a href="https://tools.ietf.org/html/rfc7517#section-5">JWK set format per RFC 7517 section 5</a>) or any other format specific to the technology used in that Member State.</p>
<p>For the sake of simplicity: Member States may both submit their existing CSCA certificates from their ICAO eMRTD systems or, as recommended by the WHO, create one specifically for this health domain. </p>
<h4 id="hcertx-security-considerations-in-hcertx_1">In HCERTX</h4>
<p>One way of looking at HCERTX is that it implements a "special Member State-specific list" as described above. That is, HCERTX is complementary to HCERT and coexists with it. In this respect, the consolidated list of DSCs from all Member States is published in the blockchain(s) used by HCERTX. Verifier applications can use this consolidated list published in every node of the blockchain network to verify standard HCERT certificates issued by the Member States.</p>
<p>In addition, thanks to the blockchain, HCERTX allows the usage of the same mechanism of Trusted List in the blockchain to facilitate the verification of certificates issued by any other entity which is authorised and added to the Trusted List in a secure way.</p>
<h3 id="hcertx-security-considerations-the-key-identifier-kid">The Key Identifier (<code>kid</code>)</h3>
<p>The Key Identifier (<code>kid</code>) is calculated when constructing the list of trusted public keys from DSC certificates and consists of a truncated (first 8 bytes) SHA-256 fingerprint of the DSC encoded in DER (raw) format.</p>
<p>Note that Verifiers do not need to calculate the <code>kid</code> based on the DSC certificate and can directly match the Key Identifier in issued health certificates with the <code>kid</code> on the trusted list.</p>
<h3 id="hcertx-security-considerations-differences-to-the-icao-emrtd-pki-trust-model">Differences to the ICAO eMRTD PKI Trust Model</h3>
<p>While patterned on best practices of the ICAO eMRTD PKI trust model, there are a number of simplifications made in the interest of speed (and recognising the fact that the EU Regulation for EHN is sharply limited in time and scope):</p>
<ul>
<li>A Member State may submit multiple CSCA certificates.</li>
<li>The DSC (key usage) validity period may be set to any length not exceeding the CSCA <em>and MAY be absent</em>.</li>
<li>The DSC certificate MAY contain policy identifiers (Extended Key Usage) that are EHN specific.</li>
<li>Member States may choose to never do any verification of published revocations; but instead purely rely on the DSC lists they get daily from the Secretariat or compile themselves.</li>
</ul></section><h1 class='nav-section-title-end'>Ended: HCERTX</h1><h1 class='nav-section-title'>W3C Credentials</h1><section class="print-page" id="credentials-w3c"><h1 id="credentials-w3c-w3c-verifiable-credentials">W3C Verifiable Credentials</h1>
<h2 id="credentials-w3c-data-model">Data Model</h2>
<p>The credential uses the standard <a href="https://www.w3.org/TR/vc-data-model">W3C Verifiable Credentials Data Model</a> for its representation, with some extensions to facilitate interoperability across blockchains.</p>
<p>The specific credential data is encoded in the <code>credentialSubject</code> field of the VC. The following figure represents the VC structure without the specific credential data.</p>
<p><img alt="Kroki" src="https://kroki.io/plantuml/svg/eNqdlF1rgzAUhu_9FcHdtn7VivOq0g1WGGzg6M0oI9XTmjaLYqKujP73mU5tXe3oJgTJed9zfE5ycMIFzsSGJwwFeAUzTjGL3ubTAL-nFJSbmKxjWi2BVMK52gkU4dke6UgNM4iACYJpkC83EIorXTJafSOHyP9Xitw8Ei5QskIMRJlk2wpY-VTQ4Tnwe0iNSOQB5cSb-y_3wdB3Hcu0bMtQB42R50tptB3TcMaG-3BUCBaVYjqGOzassWO3AnyktXA7sk-FCt1DDUIdm4QJE_AhS712lFqPhUi5p-tlWWrlSEuytW4Zpqsf--d6YbZUvbmYYi4ygrU1EXG-1Eiik0Oy2P2pTpqRAoc7mXIA0UqgdLhlSclONVmnU2bRraqKXQqX-p1DRlYELylMW7J-Kr_u6vqM52_GE9uvmOcj9vP2zox3WOALroaa7dDRL0dL7THve_nb6e4_u9p1NvaDy97aM4u0Zkb6aBa9NBQKoE8rv4LKMAvljVod315p3ntlAiySPxblC5PnH3s=" /></p>
<p>The figure above represents the VC where some fields have been marked:</p>
<ol>
<li>
<p>The <code>iss</code> field (issuer in VC terminology), uses the DID method <code>elsi</code>, specific for juridical persons and explained in a section below.</p>
</li>
<li>
<p>There is an extension to specify the blockchain network (or networks) where the VC can be verified. More precisely, the <code>issuedAt</code> field of <code>credentialSubject</code> specifies the networks where the identity for the juridical person that issued the credential can be verified.</p>
</li>
</ol>
<p>A juridical person can have its <code>elsi</code> DID registered in one or more networks, and the same credential can be verified using any of those networks. The trust on the credential depends on the trust on the registration procedure of the identity of the signer. The Verifier entity can choose to verify the credential in whatever network is trusted to the Verifier.</p>
<p>This mechanism provides a lot of flexibility in interoperability schemes across networks. More details are described in the section on interoperability.</p>
<h2 id="credentials-w3c-example-of-verifiable-credential">Example of Verifiable Credential</h2>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;exp&quot;</span><span class="p">:</span> <span class="mi">1614770844</span><span class="p">,</span>
  <span class="nt">&quot;iat&quot;</span><span class="p">:</span> <span class="mi">1614252444</span><span class="p">,</span>
  <span class="nt">&quot;iss&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-X12345678X&quot;</span><span class="p">,</span>
  <span class="nt">&quot;sub&quot;</span><span class="p">:</span> <span class="s2">&quot;46106508H&quot;</span><span class="p">,</span>
  <span class="nt">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;829588b3162249d28f3eae5e84349777&quot;</span><span class="p">,</span>
  <span class="nt">&quot;vc&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;@context&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;https://www.w3.org/2018/credentials/v1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;https://alastria.github.io/identity/credentials/v1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;https://privacycred.org/.well-known/privacycred/v1&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;VerifiableCredential&quot;</span><span class="p">,</span>
      <span class="s2">&quot;AlastriaVerifiableCredential&quot;</span><span class="p">,</span>
      <span class="s2">&quot;PrivacyCredential&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;credentialSchema&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;PrivacyCredential&quot;</span><span class="p">,</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;JsonSchemaValidator2018&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;credentialSubject&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;privacyCredential&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;citizen&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;dob&quot;</span><span class="p">:</span> <span class="s2">&quot;27-04-1982&quot;</span><span class="p">,</span>
          <span class="nt">&quot;idnumber&quot;</span><span class="p">:</span> <span class="s2">&quot;46106508H&quot;</span><span class="p">,</span>
          <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;COSTA/ALBERTO&quot;</span><span class="p">,</span>
          <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;atRisk&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;comments&quot;</span><span class="p">:</span> <span class="s2">&quot;These are some comments&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;issuedAt&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;redt.alastria&quot;</span><span class="p">],</span>
      <span class="nt">&quot;levelOfAssurance&quot;</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="credentials-w3c-verification-of-the-credentials">Verification of the credentials</h2>
<p>In general, verifying a credential received as a JWT involves the following:</p>
<ol>
<li>Deserialize the JWT without verifying it (we do not yet have the public key).</li>
<li>Get the <code>kid</code> property from the header (the JOSE header of the JWT).</li>
<li>The <code>kid</code> has the format did#id where <code>did</code> is the DID of the issuer and <code>id</code> is the identifier of the key in the DIDDocument associated to the DID.</li>
<li>Perform resolution of the DID of the issuer with the Universal Resolver API.</li>
<li>Get the public key specified inside the DIDDocument.</li>
<li>Verify the JWT using the public key associated to the DID.</li>
<li>Verify that the DID in the <code>iss</code> field of the JWT payload is the same as the one that signed the JWT.</li>
</ol>
<p>The system includes two APIs to help client applications with the verification of credentials received from other actors in the ecosystem. The choice of API depends on the trust level of the client application on the server implementing the APIs.</p>
<h3 id="credentials-w3c-using-the-universal-resolver-api">Using the Universal Resolver API</h3>
<p>In the first option the client obtains the public key of the Issuer via DID resolution. Then the client performs the cryptographic verification using the public key, without reliance on any other party.</p>
<p>The API for DID resolution is described below:</p>
<div class="admonition apidoc">
<p class="admonition-title">Universal DID resolution</p>
<p><div class="apidoc-getbox">
    <span class="apidoc-get">GET</span>
    <span class="apidoc-url">/api/did/v1/identifiers/{string:DID}</span>
</div></p>
<p>Resolves a DID and returns the DID Document (JSON format), if it exists.
It supports four DID methods: <strong>ebsi</strong>, <strong>elsi</strong>, <strong>ala</strong>, <strong>peer</strong>.</p>
<p>Only <strong>PEER</strong> and <strong>ELSI</strong> are directly implemented by this API.
The others are delegated to be resolved by their respective implementations.</p>
<p>For example, for <strong>EBSI</strong> we call the corresponding Universal Resolver API, currently in testing and available at <a href="https://api.ebsi.xyz/did/v1/identifiers/">https://api.ebsi.xyz/did/v1/identifiers/</a></p>
<p><strong>Request parameters</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DID</strong></td>
<td>string</td>
<td>The DID to resolve into a DID Document</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Reply</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>payload</strong></td>
<td>json</td>
<td>The DID document associated to the input DID</td>
</tr>
</tbody>
</table>
<p><strong>Status codes</strong></p>
<table>
<thead>
<tr>
<th>Code</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>200</strong></td>
<td>no error</td>
</tr>
<tr>
<td><strong>404</strong></td>
<td>error resolving the DID</td>
</tr>
</tbody>
</table>
<p><strong>Example request</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="nf">GET</span> <span class="nn">/api/did/v1/identifiers/did:elsi:VATES-B60645900</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">example.com</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
</code></pre></div>
<p><strong>Example response</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;@context&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;https://www.w3.org/ns/did/v1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;https://w3id.org/security/v1&quot;</span>
        <span class="p">],</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900&quot;</span><span class="p">,</span>
        <span class="nt">&quot;verificationMethod&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900#key-verification&quot;</span><span class="p">,</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;JwsVerificationKey2020&quot;</span><span class="p">,</span>
                <span class="nt">&quot;controller&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900&quot;</span><span class="p">,</span>
                <span class="nt">&quot;publicKeyJwk&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;kid&quot;</span><span class="p">:</span> <span class="s2">&quot;key-verification&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;kty&quot;</span><span class="p">:</span> <span class="s2">&quot;EC&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;crv&quot;</span><span class="p">:</span> <span class="s2">&quot;secp256k1&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;3K4iNuzPkcrHlEbhHE8vYXlF6K5xGZ2rdOrn3cQ-LnQ&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;9Z_l_hQLkq6aLuZz8gheq7R_o5ZUHUlxZ3IBGHsdzaA&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900#info&quot;</span><span class="p">,</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EntityCommercialInfo&quot;</span><span class="p">,</span>
                <span class="nt">&quot;serviceEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;www.in2.es&quot;</span><span class="p">,</span>
                <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;IN2 Innovating 2gether&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900#sms&quot;</span><span class="p">,</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SecureMessagingService&quot;</span><span class="p">,</span>
                <span class="nt">&quot;serviceEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://privatecred.hesusruiz.org/api&quot;</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="nt">&quot;anchors&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;redt.alastria&quot;</span><span class="p">,</span>
                <span class="nt">&quot;resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;UniversalResolver&quot;</span><span class="p">,</span>
                <span class="nt">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;in2.ala&quot;</span><span class="p">,</span>
                <span class="nt">&quot;ethereumAddress&quot;</span><span class="p">:</span> <span class="s2">&quot;0x8CDA8113567e633805e48c87747257E9FFAAdDF5&quot;</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="nt">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-02-08T06:53:08Z&quot;</span><span class="p">,</span>
        <span class="nt">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-02-08T06:53:08Z&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>
<h3 id="credentials-w3c-delegating-verification-to-a-trusted-server">Delegating verification to a trusted server</h3>
<p>In the second option the client delegates to a trusted server the verification of the credential, simplifying the code and complexity of secure cryptographic operations to the server. This option maybe used when the client trusts the server as it happens when they are operated by the same entity. It can be also used when the server is operated by a public administration and the citizen trusts on it.</p>
<p>This is the easiest one to use, but requires a very high level of trust. The API is described below:</p>
<div class="admonition apidoc">
<p class="admonition-title">Verification of credential in the server</p>
<p><div class="apidoc-postbox">
    <span class="apidoc-post">POST</span>
    <span class="apidoc-url">/api/verifiable-credential/v1/verifiable-credential-validations</span>
</div></p>
<p>Receives a JWT in the JWS Compact Serialization format (<a href="https://datatracker.ietf.org/doc/html/rfc7519">RFC 7519</a>) as the body of the POST request and the server verifies the credential and credential signature using internally the Universal Resolver API for resolving the DID of the Issuer and checking its digital signature.</p>
<p><strong>Request body</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>json</td>
<td>The credential in JWT format</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Reply</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>payload</strong></td>
<td>json</td>
<td>The JSON object with the verified claims in the JWT</td>
</tr>
</tbody>
</table>
<p><strong>Status codes</strong></p>
<table>
<thead>
<tr>
<th>Code</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>200</strong></td>
<td>no error</td>
</tr>
<tr>
<td><strong>404</strong></td>
<td>error resolving the DID</td>
</tr>
</tbody>
</table>
</div></section><h1 class='nav-section-title-end'>Ended: W3C Credentials</h1><h1 class='nav-section-title'>Trust Framework</h1><section class="print-page" id="trustframework-tf-overview"><h1 id="trustframework-tf-overview-trust-framework">Trust Framework</h1>
<h2 id="trustframework-tf-overview-introduction">Introduction</h2>
<p>The trust framework is basically composed of two things:</p>
<ol>
<li>A list of the identities of trusted organisations stored in the blockchain, together with associated information for each entity.</li>
<li>A process to add, modify and delete the trusted entities.</li>
</ol>
<p>The trust framework is designed to be largely decentralised and represents the trust relationships in the real world.</p>
<p>The identities of the juridical persons involved in the ecosystem are registered in a common directory implemented in the blockchain following a hierarchical scheme very similar to the DNS (Domain Name Service) schema in the Internet. Once an entity is registered in the system, it is completely autonomous for adding other entities that are managed as child entities.</p>
<p>However, there is one centralised element: the root of trust at the top of the hierarchy should be a trusted entity in the ecosystem that is the one bootstraping the system. Typically it should be a regulatory body or a public administration.</p>
<p>The approach for a single blockchain network is described in the following figure.</p>
<figure class="figure-image">
  <img src="trustframework/trustFramework.drawio.svg" alt="The Trust Framework in the blockchain">
  <figcaption>The Trust Framework in the blockchain</figcaption>
</figure>

<p>The Trust Framework in a given blockchain is not really a flat list, but a hierarchical structure, implemented as a Smart Contract:</p>
<ul>
<li>There is a special organisation which is at the root of the hierarchy. Ideally, this is a regulator, like the Central Bank of the country to manage banks, or the Ministry of Education to manage universities.</li>
<li>This root entity is responsible for registering the identities of some trusted entities. For example, in a country with several regions with autonomous competencies to manage universities, the Ministry of Education could register in the blockchain the identities of the regional institutions which are responsible for managing the universities in each of their regions.</li>
<li>Once this is done, each of the regional institutions can register the identities of dependent entities, like universities.</li>
<li>The hierarchy can have several levels. For example, a university can be big and have several organisational units with some autonomy, maybe distributed geographically. It can create sub-identities and register them as child nodes in the blockchain.</li>
</ul>
<p>Some observations about this structure:</p>
<ul>
<li>An organisation can be registered in the blockchain only because its parent entity has registered it. No other entity in the Trust Framework can have performed the registration, not even the parent of the parent entity.</li>
<li>An organisation is responsible for all its child entities, represented as child nodes in the blockchain.</li>
<li>A third party external to the framework </li>
</ul>
<h2 id="trustframework-tf-overview-creating-identities">Creating identities</h2>
<p>A new identity can only be registered as a sub-node by an existing entity already registered in the system. The API used is <strong>/api/did/v1/identifiers</strong> and its definition is the following:</p>
<div class="admonition apidoc">
<p class="admonition-title">Create an identity</p>
<p><div class="apidoc-postbox">
    <span class="apidoc-post">GET</span>
    <span class="apidoc-url">/api/did/v1/identifiers</span>
</div></p>
<p>Create an Identity anchored in the blockchain.</p>
<p><strong>Request parameters</strong></p>
<p>The body of the request is a JSON object with the following fields</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DID</strong></td>
<td>string</td>
<td>The DID to resolve into a DID Document</td>
<td>"did:elsi:VATES-B60645900"</td>
</tr>
<tr>
<td>domain_name</td>
<td>string</td>
<td>Domain name to assign in the hierarchy</td>
<td>"in2.ala"</td>
</tr>
<tr>
<td>website</td>
<td>string</td>
<td>Website of the entity</td>
<td>"www.in2.es"</td>
</tr>
<tr>
<td>commercial_name</td>
<td>string</td>
<td>Commercial name</td>
<td>"IN2 Innovating 2gether"</td>
</tr>
<tr>
<td>new_privatekey</td>
<td>PrivatekeyJWK</td>
<td>The private key of the new entity</td>
<td></td>
</tr>
<tr>
<td>parent_privatekey</td>
<td>PrivatekeyJWK</td>
<td>The private key of caller (in this case the owner of "ala")</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Example request</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;DID&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900&quot;</span><span class="p">,</span>
    <span class="nt">&quot;domain_name&quot;</span><span class="p">:</span> <span class="s2">&quot;in2.ala&quot;</span><span class="p">,</span>
    <span class="nt">&quot;website&quot;</span><span class="p">:</span> <span class="s2">&quot;www.in2.es&quot;</span><span class="p">,</span>
    <span class="nt">&quot;commercial_name&quot;</span><span class="p">:</span> <span class="s2">&quot;IN2 Innovating 2gether&quot;</span><span class="p">,</span>
    <span class="nt">&quot;new_privatekey&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;kty&quot;</span><span class="p">:</span> <span class="s2">&quot;EC&quot;</span><span class="p">,</span>
        <span class="nt">&quot;crv&quot;</span><span class="p">:</span> <span class="s2">&quot;secp256k1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;d&quot;</span><span class="p">:</span> <span class="s2">&quot;Dqv3jmu8VNMKXWrHkppr5473sLMzWBczRhzdSdpxDfI&quot;</span><span class="p">,</span>
        <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;FTiW0a4r7S2SwjL7AlFlN1yJNWF--4_x3XTTxkFbJ9o&quot;</span><span class="p">,</span>
        <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;MmpxbQCOZ0L9U6rLLkD_U8LRGwYEHcoN-DPnEdlpt6A&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;parent_privatekey&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;kty&quot;</span><span class="p">:</span> <span class="s2">&quot;EC&quot;</span><span class="p">,</span>
        <span class="nt">&quot;crv&quot;</span><span class="p">:</span> <span class="s2">&quot;secp256k1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;d&quot;</span><span class="p">:</span> <span class="s2">&quot;Dqv3jmu8VNMKXWrHkppr5473sLMzWBczRhzdSdpxDfI&quot;</span><span class="p">,</span>
        <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;NKW_0Fs4iumEegzKoOH0Trwtje1sXsG9Z1949sA8Omo&quot;</span><span class="p">,</span>
        <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;g4B3EI0qIdlcXTn-2RpUxgVX-sxNFdqCQDD0aHztVkk&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Reply</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>payload</strong></td>
<td>json</td>
<td>The DID document associated to the input DID</td>
</tr>
</tbody>
</table>
</div>
<p>A more detailed explanation of each field in the request follows:</p>
<dl>
<dt><strong>DID</strong></dt>
<dd>is the DID of the new entity. We support ELSI DID method (ELSI_DID_Method) and AlastriaID. The DID has to be created before the call to the API with the appropriate method for the DID. In the case of ELSI this is trivial and described in the section mentioned above.</dd>
<dt><strong>domain_name</strong></dt>
<dd>the domain name for the new entity in the Trust Framework. In the example it is <code>in2.ala</code> because it will be a sub-node of the Alastria one. The new identity will be created as a child node of the existing node owned by the entity controlling the <strong>parent_privatekey</strong>. If the parent domain name specified here is not owned by the entity controlling the <strong>parent_privatekey</strong>, an error is returned and no action is taken.</dd>
<dt><strong>website</strong></dt>
<dd>the website address in the off-chain world, so other participants can look more information about the entity. This field is informational only. However, it can be used by external appications to check that the entity in th ereal world corresponds to the one registered in th eblockchain.</dd>
<dt><strong>commercial_name</strong></dt>
<dd>the name of the company as it appears in the official register of the country/region. For example, in the case of IN2 (a Spanish business), the name should be the one registered in the <a href="http://www.rmc.es/Home.aspx?lang=en">Business Registry of Spain</a>.</dd>
<dt><strong>new_privatekey</strong></dt>
<dd>is the Private Key of the new entity, in JWK format. In this case the new entity is IN2. Please make sure the server being called is highly trusted.</dd>
<dt><strong>parent_privatekey</strong></dt>
<dd>is the Private Key of the entity owning/controlling the parent node in the domain name, in JWK format. In this case the parent node is <code>ala</code>, corresponding to Alastria. Please make sure the server being called is highly trusted. Ideally, the server has to be operated by the same entity calling the API.</dd>
</dl></section><section class="print-page" id="trustframework-smart-contracts"><h1 id="trustframework-smart-contracts-smart-contracts">Smart Contracts</h1>
<p>The Trust Framework is implemented by the Smart Contracts described below.</p>
<h2 id="trustframework-smart-contracts-the-main-registry">The main registry</h2>
<dl>
<dt><strong>ENSRegistry.sol</strong></dt>
<dd>Implements the main registry and is the first contract that should be deployed.</dd>
<dt><strong>ENS.sol</strong></dt>
<dd>Defines the interfaces and is included by <code>ENSRegistry</code> and other contracts.</dd>
</dl>
<h2 id="trustframework-smart-contracts-the-resolver-contracts">The resolver contracts</h2>
<p>These contracts implement resolution of different types of information that can be registered in the blockchain.</p>
<dl>
<dt><strong>PublicResolver.sol</strong></dt>
<dd>This is the main contract and the only one that must be compiled, because all others are included.</dd>
<dt><strong>ResolverBase.sol</strong></dt>
<dd>A utility contract used by all other contracts specialised in resolving different types of information.</dd>
</dl>
<p>Inside the ''profiles'' directory we can find the specialised contracts, all of them are included by the
<code>PublicResolver.sol</code> contract.</p>
<dl>
<dt><strong>AlaDIDPublicEntityResolver.sol</strong></dt>
<dd>Registers and resolves the identities of juridical persons (businesses, institutions, etc.). It keeps the DID
and information required to build the associated DID Document. This contract registers and resolves the first
public key associated to the DID. Additional public keys are registed using the <code>AlaDIDPubkeyResolver</code> contract.</dd>
<dt><strong>AlaDIDPubkeyResolver.sol</strong></dt>
<dd>Registers and resolves the public keys associated to the DID. In reality, it is used only if the DID has more
than one public key. In the simple case where the DID has only one public key, it is registered and resolved
directly by the <code>AlaDIDPublicEntityResolver</code> contract.</dd>
<dt><strong>AlaPublicCredentialResolver.sol</strong></dt>
<dd>Registers and resolves metadata about public credentials associated to the DID. In the case of juridical persons,
they may want to register publicly available credentials (e.g. self-declarations). In general, the bulk of the
credential data should be stored off-chain, but this contract allows registering critical credential metadata,
including a tamper-resistant pointer to the actual location of the credential details.</dd>
<dt><strong>AlaTSPResolver.sol</strong></dt>
<dd>Registers and resolves special entities. It is a specialisation of <code>AlaDIDPublicEntityResolver</code> in the sense
that it is intended for registration of the Trust Service Providers (TSPs), implementing the EU TSP List of Lists
on the blockchian. It contains the associated X509 certificates for each TSP, making it very efficient to verify
digital signatures existing off-chain.</dd>
<dt><strong>NameResolver.sol</strong></dt>
<dd>It performs reverse resolution, from domain name to blockchain address. Each entity in the Trust Framework has
a domain name assigned at the moment of registration, much in the same way as it happens with standard domain
names. This contract provides a secure way to determine from the domain name the blockchain address associated
to it and then retrieve all additional information.</dd>
<dt><strong>ContentHashResolver.sol</strong></dt>
<dd>Registers and resolves Content-addressable Identifiers. It provides the ability for a DID to register pointers
to additional information that they want to make available to the public.</dd>
<dt><strong>TextResolver.sol</strong></dt>
<dd>A general registration and resolution of any text that the DID wants to store associated to its DID. The content
is free-format and can be used for almost any purpose that the DID wishes. However, being free-format means that
the actual format and semantics may not be understood by everybody.</dd>
</dl>
<h2 id="trustframework-smart-contracts-deployment-of-the-smart-contracts">Deployment of the Smart Contracts</h2>
<h3 id="trustframework-smart-contracts-compilation">Compilation</h3>
<p>Only two contracts have to be compiled: <code>ENSRegistry.sol</code> and <code>PublicResolver.sol</code>. All the others are included by these two.</p>
<h3 id="trustframework-smart-contracts-deployment">Deployment</h3>
<p>The deployment has to be performed in strict order: first <code>ENSRegistry.sol</code> and then <code>PublicResolver.sol</code>.</p>
<p>The constructor of <code>PublicResolver.sol</code> requires the deployed address of <code>ENSRegistry.sol</code>, so it can invoke its
functions when registering/resolving information.</p></section><h1 class='nav-section-title-end'>Ended: Trust Framework</h1><h1 class='nav-section-title'>DID Methods</h1><section class="print-page" id="didmethods-elsi"><h1 id="didmethods-elsi-elsi-did-method-for-organisations">ELSI: DID Method for organisations</h1>
<p>The system supports several DID Methods, using the Universal Resolver to resolve each DID into a corresponding DID Document.</p>
<p>However, the main DID method used for organisations and currently implemented in Alastria Red-T is <strong>ELSI</strong>, where the identities of juridical persons are anchored into a Public-Permissioned blockchain.</p>
<p>The name ELSI stands for <strong>E</strong>TSI <strong>L</strong>egal person <strong>S</strong>emantics <strong>I</strong>dentifier, because it is based on the <em>Legal person semantic identifier</em> defined in the <a href="https://www.etsi.org/deliver/etsi_en/319400_319499/31941201/01.04.02_20/en_31941201v010402a.pdf">European Norm ETSI EN 319 412-1</a>, related to digital signatures, peer entity authentication, data authentication as well as data confidentiality.</p>
<p>The basic idea is to generate the DID deterministically from an existing and widely accepted identifier, which is already required by any organisation in the real world in order to perform any relevant activity.</p>
<p>The rational for ELSI is the following:</p>
<dl>
<dt><strong>The DID for a juridical person is essentially different to the DID for a natural person.</strong></dt>
<dd>
<p>Identities of juridical persons are public, together with information associated to the identity. This is not optional, and before an organisation starts performing any relevant operation in the real world, it has to be registered in some official register, where the identity and associated information is publicly acessible.</p>
<p>However, real-world identities of natural persons and associated PII are subject to very strict privacy regulations (GDPR). Identities are not public, and special care should be taken to keep everything related to the identity private.</p>
<p>This suggests the need for totally different mechanisms to generate and manage the DIDs of those radically different types of entities. Clean separation of the mechanisms allows for easier implementation of each set of requirements, without polluting the code with logic to handle both cases, which is prone to error.
Of course, there is nothing preventing reuse of common logic across both implementations, but only when it makes sense and maintaining the clean separation principle.</p>
<p>In addition, this separation reflects current practice in managing identities of organisations and natural persons, so it is easier to leverage existing know-how.</p>
</dd>
<dt><strong>Most organisations can already be identified by the VAT or LEI (or both).</strong></dt>
<dd>
<p>For example, businesses have to be registered in the Business Registrar of the country of incorporation, including the compulsory Tax Identification Number or VAT. Even organisations which do not require a VAT to be incorporated are required to have a LEI (Legal Entity Identifier).</p>
<p>Using the VAT and LEI can identify an enormous amount of organisations: businesses, non profits, universities, research centers, public administrations, etc.</p>
<p>In exceptional cases where VAT or LEI can not be used, ELSI uses the extensibility mechanism in <code>ETSI EN 319 412-1</code> to include any existing type of compulsory registration, whether international or just national.</p>
</dd>
</dl>
<p>These requirements have nothing to do with whether we use centralised technology or blockchains. It is an essential characterictic in any developed economy like the EU.</p>
<p>This means that the creation of the DID is completely decentralised from the point of view of the blockchain networks, because the entities willing to participate already possess everything which is needed in order to create the DID. We do not need to put in place any other entity or system to create the DID.</p>
<p>The ETSI norm on which ELSI is based specifies several possible identifiers that can be used to build the DID. The two most common and the ones used in ELSI are the <code>VAT</code> (Tax Identifier) and the <code>LEI</code> (<a href="https://www.gleif.org">Legal Entity Identifier</a>).</p>
<p>Using both <code>VAT</code> and <code>LEI</code> in creating the DID covers every juridical person that can participate in a blockchain network, not only in the EU but in most of the world. In any case, the system is extensible and it is fairly easy to incorporate new legal identifiers if the need arises in the future.</p>
<h2 id="didmethods-elsi-elsi-did-syntax">ELSI DID syntax</h2>
<p>The ELSI DID Method refers only to legal persons, so we are using the <code>id-etsi-qcs-SemanticsId-Legal</code> definition described in Section 5.1 of ETSI EN 319 412-1.</p>
<p>Creating a DID is extremely simple and fully decentralized (does not require participation of any central authority), assuming that the legal person already exists (which is a prerequisite for doing anything useful). Its definition using ABNF syntax is:</p>
<div class="highlight"><pre><span></span><code>    <span class="n">did</span> <span class="o">=</span> <span class="s2">&quot;did:elsi:&quot;</span> <span class="nb">id</span><span class="o">-</span><span class="n">etsi</span><span class="o">-</span><span class="n">qcs</span><span class="o">-</span><span class="n">SemanticsId</span><span class="o">-</span><span class="n">Legal</span>
</code></pre></div>
<p>Which is the concatenation of the prefix <code>did:elsi:</code> with the legal person identifier defined in <a href="https://www.etsi.org/deliver/etsi_en/319400_319499/31941201/01.04.02_20/en_31941201v010402a.pdf">ETSI EN 319 412-1</a>. Tthe identifier has the following structure, in this order:</p>
<ul>
<li>3 character legal person identity type reference; </li>
<li>2 character <a href="https://www.iso.org/standard/72482.html">ISO 3166</a> country code; </li>
<li>hyphen-minus "-" (0x2D (ASCII), U+002D (UTF-8)); and </li>
<li>identifier (according to country and identity type reference).</li>
</ul>
<p>The three initial characters (identity type reference) shall have one of the following defined values for the two most common basic identifiers (<code>VAT</code> and <code>LEI</code>): </p>
<ol>
<li><code>VAT</code> for identification based on a national value added tax identification number. </li>
<li><code>LEI</code> for a <a href="https://www.gleif.org">global Legal Entity Identifier</a> as specified in <a href="https://www.iso.org/standard/78829.html">ISO 17442</a>. The 2 character <a href="https://www.iso.org/standard/72482.html">ISO 3166</a> country code shall be set to <code>XG</code>.</li>
</ol>
<p>The system supports also identification based on national authorization number of a payment service provider under <a href="https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A32015L2366">Payments Services Directive (EU) 2015/2366</a> (<code>PSD</code>), identifiers from a national trade register (<code>NTR</code>), or other national scheme that is considered appropriate for national and European level. For the full syntax, please refer to the standards document. However, it is expected that the need for these identifiers is very low and that the two identifiers described above should be enough for the immense majority of use cases.</p>
<p>Some examples of DIDs are the following:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>DID</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>AgID</strong> (www.agid.gov.it)</td>
<td><strong>did:elsi:VATIT-97735020584</strong></td>
</tr>
<tr>
<td><strong>Hashnet d.o.o.</strong> (hashnet.tech)</td>
<td><strong>did:elsi:VATSI-18035094</strong></td>
</tr>
<tr>
<td><strong>Alastria</strong> (alastria.io)</td>
<td><strong>did:elsi:VATES-G87936159</strong></td>
</tr>
<tr>
<td><strong>Enel Spa</strong> (www.enel.com)</td>
<td><strong>did:elsi:VATIT-15844561009</strong></td>
</tr>
<tr>
<td><strong>Endesa S.A.</strong> (www.endesa.com)</td>
<td><strong>did:elsi:VATES-A81948077</strong></td>
</tr>
<tr>
<td><strong>Inter-American Development Bank</strong> (www.iadb.org)</td>
<td><strong>did:elsi:LEIXG-VKU1UKDS9E7LYLMACP54</strong></td>
</tr>
</tbody>
</table>
<h2 id="didmethods-elsi-elsi-did-document">ELSI DID Document</h2>
<p>An example DID Document is the following:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;@context&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;https://www.w3.org/ns/did/v1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;https://w3id.org/security/v1&quot;</span>
    <span class="p">],</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900&quot;</span><span class="p">,</span>
    <span class="nt">&quot;verificationMethod&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900#key-verification&quot;</span><span class="p">,</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;JwsVerificationKey2020&quot;</span><span class="p">,</span>
        <span class="nt">&quot;controller&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900&quot;</span><span class="p">,</span>
        <span class="nt">&quot;publicKeyJwk&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;kid&quot;</span><span class="p">:</span> <span class="s2">&quot;key-verification&quot;</span><span class="p">,</span>
          <span class="nt">&quot;kty&quot;</span><span class="p">:</span> <span class="s2">&quot;EC&quot;</span><span class="p">,</span>
          <span class="nt">&quot;crv&quot;</span><span class="p">:</span> <span class="s2">&quot;secp256k1&quot;</span><span class="p">,</span>
          <span class="nt">&quot;x&quot;</span><span class="p">:</span> <span class="s2">&quot;3K4iNuzPkcrHlEbhHE8vYXlF6K5xGZ2rdOrn3cQ-LnQ&quot;</span><span class="p">,</span>
          <span class="nt">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;9Z_l_hQLkq6aLuZz8gheq7R_o5ZUHUlxZ3IBGHsdzaA&quot;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900#info&quot;</span><span class="p">,</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;EntityCommercialInfo&quot;</span><span class="p">,</span>
        <span class="nt">&quot;serviceEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;www.in2.es&quot;</span><span class="p">,</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;IN2 Innovating 2gether&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;did:elsi:VATES-B60645900#sms&quot;</span><span class="p">,</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SecureMessagingService&quot;</span><span class="p">,</span>
        <span class="nt">&quot;serviceEndpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;https://privatecred.hesusruiz.org/api&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;anchors&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;redt.alastria&quot;</span><span class="p">,</span>
        <span class="nt">&quot;resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;UniversalResolver&quot;</span><span class="p">,</span>
        <span class="nt">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;in2.ala&quot;</span><span class="p">,</span>
        <span class="nt">&quot;ethereumAddress&quot;</span><span class="p">:</span> <span class="s2">&quot;0x8CDA8113567e633805e48c87747257E9FFAAdDF5&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;created&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-02-08T06:53:08Z&quot;</span><span class="p">,</span>
    <span class="nt">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-02-08T06:53:08Z&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></section><h1 class='nav-section-title-end'>Ended: DID Methods</h1><h1 class='nav-section-title'>Interoperability</h1><section class="print-page" id="interoperability-interoperability-eudcc"><h1 id="interoperability-interoperability-eudcc-interoperability-with-eudcc">Interoperability with EUDCC</h1></section><section class="print-page" id="interoperability-interoperability-w3c"><h1 id="interoperability-interoperability-w3c-interoperability-using-w3c">Interoperability using W3C</h1></section><h1 class='nav-section-title-end'>Ended: Interoperability</h1></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Footer -->
<footer class="md-footer">
  <!-- Link to previous and/or next page -->
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        <div class="md-footer-copyright__highlight">
          <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
            <img
              alt="Creative Commons License"
              style="border-width: 0"
              src="https://i.creativecommons.org/l/by/4.0/88x31.png"
            /> </a
          ><br />This work is licensed under a
          <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"
            >Creative Commons Attribution 4.0 International License</a
          >. Made with
          <a
            href="https://squidfunk.github.io/mkdocs-material/"
            target="_blank"
            rel="noopener"
          >
            Material for MkDocs
          </a>
        </div>
      </div>

      <!-- Social links -->
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "navigation.expand"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.b0710199.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.76f349be.min.js"></script>
      
        <script src="js/print-site-instant-loading.js"></script>
      
        <script src="js/print-site.js"></script>
      
    
  
        <script type="text/javascript">
        window.addEventListener('load', function () {
            generate_toc();
        })
        </script>
        </body>
</html>